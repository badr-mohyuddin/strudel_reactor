import e from"C:/Users/mofi3/OneDrive/Documents/StrudelClone/Strudel/strudel_reactor/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import t from"C:/Users/mofi3/OneDrive/Documents/StrudelClone/Strudel/strudel_reactor/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";var s;import n from"fraction.js";const r="strudel.log";let a,o;function i(e){c("[".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cyclist","] error: ").concat(e.message))}function c(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=performance.now();a===e&&n-o<1e3||(a=e,o=n,console.log("%c".concat(e),"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(r,{detail:{message:e,type:t,data:s}})))}c.key=r;const u=e=>/^[a-gA-G][#bs]*[0-9]$/.test(e),l=e=>/^[a-gA-G][#bsf]*[0-9]?$/.test(e),p=e=>{var t;if("string"!=typeof e)return[];const[s,n="",r]=(null===(t=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/))||void 0===t?void 0:t.slice(1))||[];return s?[s,n,r?Number(r):void 0]:[]},h={c:0,d:2,e:4,f:5,g:7,a:9,b:11},d={"#":1,b:-1,s:1,f:-1},f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;const[s,n,r=t]=p(e);if(!s)throw new Error('not a note: "'+e+'"');const a=h[s.toLowerCase()],o=(null===n||void 0===n?void 0:n.split("").reduce((e,t)=>e+d[t],0))||0;return 12*(Number(r)+1)+a+o},m=e=>440*Math.pow(2,(e-69)/12),y=e=>12*Math.log(e/440)/Math.LN2+69,g=(e,t)=>{if("object"!=typeof e)throw new Error("valueToMidi: expected object value");let{freq:s,note:n}=e;if("number"==typeof s)return y(s);if("string"==typeof n)return f(n);if("number"==typeof n)return n;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t},v=(e,t)=>1e3*(e-t),b=e=>m("number"==typeof e?e:f(e)),w=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],_=e=>{const t=Math.floor(e/12)-1;return w[e%12]+t},k=(e,t)=>(e%t+t)%t,A=e=>e.reduce((e,t)=>e+t)/e.length;function q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return isNaN(Number(e))?(c('"'.concat(e,'" is not a number, falling back to ').concat(t),"warning"),t):e}const S=(e,t)=>k(Math.round(q(null!==e&&void 0!==e?e:0,0)),t),x=e=>{let{value:t,context:s}=e,n=t;if("object"==typeof n&&!Array.isArray(n)&&(n=n.note||n.n||n.value,void 0===n))throw new Error("cannot find a playable note for ".concat(JSON.stringify(t)));if("number"==typeof n&&"frequency"!==s.type)n=m(e.value);else if("number"==typeof n&&"frequency"===s.type)n=e.value;else if("string"!=typeof n||!l(n))throw new Error("not a note: "+JSON.stringify(n));return n},T=e=>{let{value:t,context:s}=e;if("object"==typeof t)return t.freq?t.freq:b(t.note||t.n||t.value);if("number"==typeof t&&"frequency"!==s.type)t=m(e.value);else if("string"==typeof t&&l(t))t=m(f(e.value));else if("number"!=typeof t)throw new Error("not a note or frequency: "+t);return t},z=(e,t)=>e.slice(t).concat(e.slice(0,t)),C=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.reduce((e,t)=>function(){return e(t(...arguments))},e=>e)},B=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return C(...t.reverse())},O=e=>e.filter(e=>null!=e),E=e=>[].concat(...e),j=e=>e,J=(e,t)=>e,M=(e,t)=>Array.from({length:t-e+1},(t,s)=>s+e);function P(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length;const n=function n(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];if(a.length>=s)return e.apply(this,a);{const e=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return n.apply(this,a.concat(t))};return t&&t(e,a),e}};return t&&t(n,[]),n}function N(e){const t=Number(e);if(!isNaN(t))return t;if(l(e))return f(e);throw new Error('cannot parse as numeral: "'.concat(e,'"'))}function R(e,t){return function(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return e(...n.map(t))}}function L(e){return R(e,N)}function I(e){const t=Number(e);if(!isNaN(t))return t;const s={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[e];if(typeof s<"u")return s;throw new Error('cannot parse as fractional: "'.concat(e,'"'))}const W=e=>R(e,I),H=function(e,t){return[t.slice(0,e),t.slice(e)]},D=(e,t,s)=>t.map((t,n)=>e(t,s[n])),V=function(e){const t=[];for(let s=0;s<e.length-1;++s)t.push([e[s],e[s+1]]);return t},F=(e,t,s)=>Math.min(Math.max(e,t),s),G=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],U=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],Q=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],K=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],$=["I","Ro","Ha","Ni","Ho","He","To"],Z=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],X=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"letters";return("solfeggio"===t?G:"indian"===t?U:"german"===t?Q:"byzantine"===t?K:"japanese"===t?$:Z)[e%12]+(Math.floor(e/12)-1)};function Y(e){var t={};return e.filter(function(e){return!t.hasOwn(e)&&(t[e]=!0)})}function ee(e){return e.sort().filter(function(e,t,s){return!t||e!=s[t-1]})}function te(e){return e.sort((e,t)=>e.compare(t)).filter(function(e,t,s){return!t||e.ne(s[t-1])})}function se(e){const t=(new TextEncoder).encode(e);return btoa(String.fromCharCode(...t))}function ne(e){const t=new Uint8Array(atob(e).split("").map(e=>e.charCodeAt(0)));return(new TextDecoder).decode(t)}function re(e){return encodeURIComponent(se(e))}function ae(e){return ne(decodeURIComponent(e))}function oe(e,t){return Array.isArray(e)?e.map(t):Object.fromEntries(Object.entries(e).map((e,s)=>{let[n,r]=e;return[n,t(r,n,s)]}))}function ie(e,t){return e/t}class ce{constructor(e){let{getTargetClockTime:t=le,weight:s=16,offsetDelta:n=.005,checkAfterTime:r=2,resetAfterTime:a=8}=e;this.offsetTime,this.timeAtPrevOffsetSample,this.prevOffsetTimes=[],this.getTargetClockTime=t,this.weight=s,this.offsetDelta=n,this.checkAfterTime=r,this.resetAfterTime=a,this.reset=()=>{this.prevOffsetTimes=[],this.offsetTime=null,this.timeAtPrevOffsetSample=null}}calculateOffset(e){const t=this.getTargetClockTime(),s=t-this.timeAtPrevOffsetSample,n=t-e;if(s>this.resetAfterTime&&this.reset(),null==this.offsetTime&&(this.offsetTime=n),this.prevOffsetTimes.push(n),this.prevOffsetTimes.length>this.weight&&this.prevOffsetTimes.shift(),null==this.timeAtPrevOffsetSample||s>this.checkAfterTime){this.timeAtPrevOffsetSample=t;const e=A(this.prevOffsetTimes);Math.abs(e-this.offsetTime)>this.offsetDelta&&(this.offsetTime=e)}return this.offsetTime}calculateTimestamp(e,t){return this.calculateOffset(e)+t}}function ue(){return.001*performance.now()}function le(){return.001*Date.now()}const pe=new Map([["control","Control"],["ctrl","Control"],["alt","Alt"],["shift","Shift"],["down","ArrowDown"],["up","ArrowUp"],["left","ArrowLeft"],["right","ArrowRight"]]);let he;function de(){if(null==he){if(typeof window>"u")return;he={},window.addEventListener("keydown",e=>{he[e.key]=!0}),window.addEventListener("keyup",e=>{he[e.key]=!1})}return t({},he)}function fe(e){return"object"==typeof e?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?JSON.stringify(e).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(e):e}n.prototype.sam=function(){return this.floor()},n.prototype.nextSam=function(){return this.sam().add(1)},n.prototype.wholeCycle=function(){return new ve(this.sam(),this.nextSam())},n.prototype.cyclePos=function(){return this.sub(this.sam())},n.prototype.lt=function(e){return this.compare(e)<0},n.prototype.gt=function(e){return this.compare(e)>0},n.prototype.lte=function(e){return this.compare(e)<=0},n.prototype.gte=function(e){return this.compare(e)>=0},n.prototype.eq=function(e){return 0==this.compare(e)},n.prototype.ne=function(e){return 0!=this.compare(e)},n.prototype.max=function(e){return this.gt(e)?this:e},n.prototype.maximum=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return(t=t.map(e=>new n(e))).reduce((e,t)=>t.max(e),this)},n.prototype.min=function(e){return this.lt(e)?this:e},n.prototype.mulmaybe=function(e){return void 0!==e?this.mul(e):void 0},n.prototype.divmaybe=function(e){return void 0!==e?this.div(e):void 0},n.prototype.addmaybe=function(e){return void 0!==e?this.add(e):void 0},n.prototype.submaybe=function(e){return void 0!==e?this.sub(e):void 0},n.prototype.show=function(){return this.s*this.n+"/"+this.d},n.prototype.or=function(e){return this.eq(0)?e:this};const me=e=>n(e),ye=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(0!==(t=O(t)).length)return t.reduce((e,t)=>e.gcd(t),me(1))},ge=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(0===(t=O(t)).length)return;const n=t.pop();return t.reduce((e,t)=>void 0===e||void 0===t?void 0:e.lcm(t),n)};me._original=n;class ve{constructor(e,t){this.begin=me(e),this.end=me(t)}get spanCycles(){const e=[];var t=this.begin;const s=this.end,n=s.sam();if(t.equals(s))return[new ve(t,s)];for(;s.gt(t);){if(t.sam().equals(n)){e.push(new ve(t,this.end));break}const s=t.nextSam();e.push(new ve(t,s)),t=s}return e}get duration(){return this.end.sub(this.begin)}cycleArc(){const e=this.begin.cyclePos(),t=e.add(this.duration);return new ve(e,t)}withTime(e){return new ve(e(this.begin),e(this.end))}withEnd(e){return new ve(this.begin,e(this.end))}withCycle(e){const t=this.begin.sam(),s=t.add(e(this.begin.sub(t))),n=t.add(e(this.end.sub(t)));return new ve(s,n)}intersection(e){const t=this.begin.max(e.begin),s=this.end.min(e.end);if(!t.gt(s)&&(!t.equals(s)||!(t.equals(this.end)&&this.begin.lt(this.end)||t.equals(e.end)&&e.begin.lt(e.end))))return new ve(t,s)}intersection_e(e){const t=this.intersection(e);if(null==t)throw"TimeSpans do not intersect";return t}midpoint(){return this.begin.add(this.duration.div(me(2)))}equals(e){return this.begin.equals(e.begin)&&this.end.equals(e.end)}show(){return this.begin.show()+" \u2192 "+this.end.show()}}class be{constructor(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.whole=e,this.part=t,this.value=s,this.context=n,this.stateful=r,r&&console.assert("function"==typeof this.value,"Stateful values must be functions")}get duration(){var e,t;let s;return s="number"==typeof(null===(e=this.value)||void 0===e?void 0:e.duration)?me(this.value.duration):this.whole.end.sub(this.whole.begin),"number"==typeof(null===(t=this.value)||void 0===t?void 0:t.clip)?s.mul(this.value.clip):s}get endClipped(){return this.whole.begin.add(this.duration)}isActive(e){return this.whole.begin<=e&&this.endClipped>=e}isInPast(e){return e>this.endClipped}isInNearPast(e,t){return t-e<=this.endClipped}isInFuture(e){return e<this.whole.begin}isInNearFuture(e,t){return t<this.whole.begin&&t>this.whole.begin-e}isWithinTime(e,t){return this.whole.begin<=t&&this.endClipped>=e}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(e){const t=this.whole?e(this.whole):void 0;return new be(t,e(this.part),this.value,this.context)}withValue(e){return new be(this.whole,this.part,e(this.value),this.context)}hasOnset(){return null!=this.whole&&this.whole.begin.equals(this.part.begin)}hasTag(e){var t;return null===(t=this.context.tags)||void 0===t?void 0:t.includes(e)}resolveState(e){if(this.stateful&&this.hasOnset()){console.log("stateful");const t=this.value,[s,n]=t(e);return[s,new be(this.whole,this.part,n,this.context,!1)]}return[e,this]}spanEquals(e){return null==this.whole&&null==e.whole||this.whole.equals(e.whole)}equals(e){return this.spanEquals(e)&&this.part.equals(e.part)&&this.value===e.value}show(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t="object"==typeof this.value?e?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var s="";if(null==this.whole)s="~"+this.part.show;else{var n=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(s=this.whole.begin.show()+" \u21dc "),n||(s+="("),s+=this.part.show(),n||(s+=")"),this.whole.end.equals(this.part.end)||(s+=" \u21dd "+this.whole.end.show())}return"[ "+s+" | "+t+" ]"}showWhole(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return"".concat(null==this.whole?"~":this.whole.show(),": ").concat(fe(this.value,e))}combineContext(e){return t(t(t({},this.context),e.context),{},{locations:(this.context.locations||[]).concat(e.context.locations||[])})}setContext(e){return new be(this.whole,this.part,this.value,e)}ensureObjectValue(){if("object"!=typeof this.value)throw new Error('expected hap.value to be an object, but got "'.concat(this.value,'". Hint: append .note() or .s() to the end'),"error")}}class we{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.span=e,this.controls=t}setSpan(e){return new we(e,this.controls)}withSpan(e){return this.setSpan(e(this.span))}setControls(e){return new we(this.span,e)}}function _e(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,s=0,n=me(0),r=[""],a="";for(;r[0].length<t;){const t=e.queryArc(s,s+1),o=t.filter(e=>e.hasOnset()).map(e=>e.duration),i=ye(...o),c=i.inverse();r=r.map(e=>e+"|"),a+="|";for(let e=0;e<c;e++){const[e,s]=[n,n.add(i)],o=t.filter(t=>t.whole.begin.lte(e)&&t.whole.end.gte(s)),c=o.length-r.length;c>0&&(r=r.concat(Array(c).fill(a))),r=r.map((t,s)=>{const n=o[s];if(n){return t+(n.whole.begin.eq(e)?""+n.value:"-")}return t+"."}),a+=".",n=n.add(i)}s++}return r.join("\n")}P((e,t)=>e*t),P((e,t)=>t.map(e));let ke,Ae=!0;const qe=function(e){Ae=!!e},Se=e=>ke=e;class xe{constructor(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;e(this,"polyJoin",function(){const e=this;return e.fmap(t=>t.extend(e._steps.div(t._steps))).outerJoin()}),this.query=t,this._Pattern=!0,this._steps=s}get _steps(){return this.__steps}set _steps(e){this.__steps=void 0===e?void 0:me(e)}setSteps(e){return this._steps=e,this}withSteps(e){return Ae?new xe(this.query,void 0===this._steps?void 0:e(this._steps)):this}get hasSteps(){return void 0!==this._steps}withValue(e){const t=new xe(t=>this.query(t).map(t=>t.withValue(e)));return t._steps=this._steps,t}withState(e){return this.withHaps((t,s)=>(e(s),t))}fmap(e){return this.withValue(e)}appWhole(e,t){const s=this;return new xe(function(n){const r=s.query(n),a=t.query(n);return E(r.map(t=>O(a.map(s=>function(t,s){const n=t.part.intersection(s.part);if(null!=n)return new be(e(t.whole,s.whole),n,t.value(s.value),s.combineContext(t))}(t,s)))))})}appBoth(e){const t=this.appWhole(function(e,t){if(null!=e&&null!=t)return e.intersection_e(t)},e);return Ae&&(t._steps=ge(e._steps,this._steps)),t}appLeft(e){const t=this,s=new xe(function(s){const n=[];for(const r of t.query(s)){const t=e.query(s.setSpan(r.wholeOrPart()));for(const e of t){const t=r.whole,s=r.part.intersection(e.part);if(s){const a=r.value(e.value),o=e.combineContext(r),i=new be(t,s,a,o);n.push(i)}}}return n});return s._steps=this._steps,s}appRight(e){const t=this,s=new xe(function(s){const n=[];for(const r of e.query(s)){const e=t.query(s.setSpan(r.wholeOrPart()));for(const t of e){const e=r.whole,s=t.part.intersection(r.part);if(s){const a=t.value(r.value),o=r.combineContext(t),i=new be(e,s,a,o);n.push(i)}}}return n});return s._steps=e._steps,s}bindWhole(e,t){const s=this;return new xe(function(n){const r=function(s){return t(s.value).query(n.setSpan(s.part)).map(t=>function(t,s){return new be(e(t.whole,s.whole),s.part,s.value,Object.assign({},t.context,s.context,{locations:(t.context.locations||[]).concat(s.context.locations||[])}))}(s,t))};return E(s.query(n).map(e=>r(e)))})}bind(e){return this.bindWhole(function(e,t){if(null!=e&&null!=t)return e.intersection_e(t)},e)}join(){return this.bind(j)}outerBind(e){return this.bindWhole(e=>e,e).setSteps(this._steps)}outerJoin(){return this.outerBind(j)}innerBind(e){return this.bindWhole((e,t)=>t,e)}innerJoin(){return this.innerBind(j)}resetJoin(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this;return new xe(s=>t.discreteOnly().query(s).map(t=>t.value.late(e?t.whole.begin:t.whole.begin.cyclePos()).query(s).map(e=>new be(e.whole?e.whole.intersection(t.whole):void 0,e.part.intersection(t.part),e.value).setContext(t.combineContext(e))).filter(e=>e.part)).flat())}restartJoin(){return this.resetJoin(!0)}squeezeJoin(){const e=this;return new xe(function(t){const s=e.discreteOnly().query(t);return E(s.map(function(e){return e.value._focusSpan(e.wholeOrPart()).query(t.setSpan(e.part)).map(t=>function(e,t){let s;if(t.whole&&e.whole&&(s=t.whole.intersection(e.whole),!s))return;const n=t.part.intersection(e.part);if(!n)return;const r=t.combineContext(e);return new be(s,n,t.value,r)}(e,t))})).filter(e=>e)})}squeezeBind(e){return this.fmap(e).squeezeJoin()}polyBind(e){return this.fmap(e).polyJoin()}queryArc(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return this.query(new we(new ve(e,t),s))}catch(n){return c("[query]: ".concat(n.message),"error"),[]}}splitQueries(){const e=this;return new xe(t=>E(t.span.spanCycles.map(s=>e.query(t.setSpan(s)))))}withQuerySpan(e){return new xe(t=>this.query(t.withSpan(e)))}withQuerySpanMaybe(e){const t=this;return new xe(s=>{const n=s.withSpan(e);return n.span?t.query(n):[]})}withQueryTime(e){return new xe(t=>this.query(t.withSpan(t=>t.withTime(e))))}withHapSpan(e){return new xe(t=>this.query(t).map(t=>t.withSpan(e)))}withHapTime(e){return this.withHapSpan(t=>t.withTime(e))}withHaps(e){const t=new xe(t=>e(this.query(t),t));return t._steps=this._steps,t}withHap(e){return this.withHaps(t=>t.map(e))}setContext(e){return this.withHap(t=>t.setContext(e))}withContext(e){const t=this.withHap(t=>t.setContext(e(t.context)));return void 0!==this.__pure&&(t.__pure=this.__pure,t.__pure_loc=this.__pure_loc),t}stripContext(){return this.withHap(e=>e.setContext({}))}withLoc(e,s){const n={start:e,end:s},r=this.withContext(e=>{const s=(e.locations||[]).concat([n]);return t(t({},e),{},{locations:s})});return this.__pure&&(r.__pure=this.__pure,r.__pure_loc=n),r}filterHaps(e){return new xe(t=>this.query(t).filter(e))}filterValues(e){return new xe(t=>this.query(t).filter(t=>e(t.value))).setSteps(this._steps)}removeUndefineds(){return this.filterValues(e=>null!=e)}onsetsOnly(){return this.filterHaps(e=>e.hasOnset())}discreteOnly(){return this.filterHaps(e=>e.whole)}defragmentHaps(){return this.discreteOnly().withHaps(e=>{const t=[];for(var s=0;s<e.length;++s){for(var n=!0,r=e[s];n;){const t=JSON.stringify(e[s].value);for(var a=!1,o=s+1;o<e.length;o++){const s=e[o];if(r.whole.equals(s.whole))if(r.part.begin.eq(s.part.end)){if(t===JSON.stringify(s.value)){r=new be(r.whole,new ve(s.part.begin,r.part.end),r.value),e.splice(o,1),a=!0;break}}else if(s.part.begin.eq(r.part.end)&&t==JSON.stringify(s.value)){r=new be(r.whole,new ve(r.part.begin,s.part.end),r.value),e.splice(o,1),a=!0;break}}n=a}t.push(r)}return t})}firstCycle(){var e=this;return arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(e=e.stripContext()),e.query(new we(new ve(me(0),me(1))))}get firstCycleValues(){return this.firstCycle().map(e=>e.value)}get showFirstCycle(){return this.firstCycle().map(e=>"".concat(e.value,": ").concat(e.whole.begin.toFraction()," - ").concat(e.whole.end.toFraction()))}sortHapsByPart(){return this.withHaps(e=>e.sort((e,t)=>e.part.begin.sub(t.part.begin).or(e.part.end.sub(t.part.end)).or(e.whole.begin.sub(t.whole.begin).or(e.whole.end.sub(t.whole.end)))))}asNumber(){return this.fmap(N)}_opIn(e,t){return this.fmap(t).appLeft(Ie(e))}_opOut(e,t){return this.fmap(t).appRight(Ie(e))}_opMix(e,t){return this.fmap(t).appBoth(Ie(e))}_opSqueeze(e,t){const s=Ie(e);return this.fmap(e=>s.fmap(s=>t(e)(s))).squeezeJoin()}_opSqueezeOut(e,t){const s=this;return Ie(e).fmap(e=>s.fmap(s=>t(s)(e))).squeezeJoin()}_opReset(e,t){return Ie(e).fmap(e=>this.fmap(s=>t(s)(e))).resetJoin()}_opRestart(e,t){return Ie(e).fmap(e=>this.fmap(s=>t(s)(e))).restartJoin()}_opPoly(e,t){const s=Ie(e);return this.fmap(e=>s.fmap(s=>t(s)(e))).polyJoin()}layer(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return He(...t.map(e=>e(this)))}superimpose(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.stack(...t.map(e=>e(this)))}stack(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return He(this,...t)}sequence(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return et(this,...t)}seq(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return et(this,...t)}cat(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return $e(this,...t)}fastcat(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Ye(this,...t)}slowcat(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Qe(this,...t)}onTrigger(e){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.withHap(n=>n.setContext(t(t({},n.context),{},{onTrigger:function(){for(var t,s,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];null!==(t=(s=n.context).onTrigger)&&void 0!==t&&t.call(s,...a),e(...a)},dominantTrigger:n.context.dominantTrigger||s})))}log(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>"[hap] ".concat(e.showWhole(!0)),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>({hap:e});return this.onTrigger(function(){c(e(...arguments),void 0,t(...arguments))},!1)}logValues(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>"[hap] ".concat(fe(e,!0));return this.log(t=>e(t.value))}drawLine(){return console.log(_e(this)),this}unjoin(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j;return e.withHap(e=>e.withValue(s=>s?t(this.ribbon(e.whole.begin,e.whole.duration)):this))}into(e,t){return this.unjoin(e,t).innerJoin()}}const Te=(e,t)=>e.spanEquals(t);xe.prototype.collect=function(){return this.withHaps(e=>function(e,t){let s=[];return t.forEach(t=>{const n=s.findIndex(s=>{let[n]=s;return e(t,n)});-1===n?s.push([t]):s[n].push(t)}),s}(Te,e).map(e=>new be(e[0].whole,e[0].part,e,{})))};const ze=Rt("arpWith",(e,t)=>t.collect().fmap(t=>Ie(e(t))).innerJoin().withHap(e=>new be(e.whole,e.part,e.value.value,e.combineContext(e.value)))),Ce=Rt("arp",(e,t)=>t.arpWith(t=>Ie(e).fmap(e=>t[e%t.length])),!1);function Be(e){return!Array.isArray(e)&&"object"==typeof e}function Oe(e,t,s){return Be(e)||Be(t)?(Be(e)||(e={value:e}),Be(t)||(t={value:t}),function(e,t,s){if(void 0!==(null===t||void 0===t?void 0:t.value)&&1===Object.keys(t).length)return c("[warn]: Can't do arithmetic on control pattern."),e;const n=Object.keys(e).filter(e=>Object.keys(t).includes(e));return Object.assign({},e,t,Object.fromEntries(n.map(n=>[n,s(e[n],t[n])])))}(e,t,s)):s(e,t)}!function(){const e={set:[(e,t)=>t],keep:[e=>e],keepif:[(e,t)=>t?e:void 0],add:[L((e,t)=>e+t)],sub:[L((e,t)=>e-t)],mul:[L((e,t)=>e*t)],div:[L((e,t)=>e/t)],mod:[L(k)],pow:[L(Math.pow)],log2:[L(Math.log2)],band:[L((e,t)=>e&t)],bor:[L((e,t)=>e|t)],bxor:[L((e,t)=>e^t)],blshift:[L((e,t)=>e<<t)],brshift:[L((e,t)=>e>>t)],lt:[(e,t)=>e<t],gt:[(e,t)=>e>t],lte:[(e,t)=>e<=t],gte:[(e,t)=>e>=t],eq:[(e,t)=>e==t],eqt:[(e,t)=>e===t],ne:[(e,t)=>e!=t],net:[(e,t)=>e!==t],and:[(e,t)=>e&&t],or:[(e,t)=>e||t],func:[(e,t)=>t(e)]},t=["In","Out","Mix","Squeeze","SqueezeOut","Reset","Restart","Poly"];for(const[s,[n,r]]of Object.entries(e)){xe.prototype["_"+s]=function(e){return this.fmap(t=>n(t,e))},Object.defineProperty(xe.prototype,s,{get:function(){const e=this,a=function(){return e[s].in(...arguments)};for(const o of t)a[o.toLowerCase()]=function(){for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];var c,u=e;return a=et(a),r&&(u=r(u),a=r(a)),"keepif"===s?c=(c=u["_op"+o](a,e=>t=>n(e,t))).removeUndefineds():c=u["_op"+o](a,e=>t=>Oe(e,t,n)),c};return a.squeezein=a.squeeze,a}});for(const e of t)xe.prototype[e.toLowerCase()]=function(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return this.set[e.toLowerCase()](s)}}xe.prototype.struct=function(){return this.keepif.out(...arguments)},xe.prototype.structAll=function(){return this.keep.out(...arguments)},xe.prototype.mask=function(){return this.keepif.in(...arguments)},xe.prototype.maskAll=function(){return this.keep.in(...arguments)},xe.prototype.reset=function(){return this.keepif.reset(...arguments)},xe.prototype.resetAll=function(){return this.keep.reset(...arguments)},xe.prototype.restart=function(){return this.keepif.restart(...arguments)},xe.prototype.restartAll=function(){return this.keep.restart(...arguments)}}();const Ee=He,je=He,Je=An,Me=e=>new xe(()=>[],e),Pe=Me(1),Ne=Me(0);function Re(e){const t=new xe(function(t){return t.span.spanCycles.map(t=>new be(me(t.begin).wholeCycle(),t,e))},1);return t.__pure=e,t}function Le(e){return e instanceof xe||(null===e||void 0===e?void 0:e._Pattern)}function Ie(e){return Le(e)?e:ke&&"string"==typeof e?ke(e):Re(e)}function We(e){let t=Re([]);for(const s of e)t=t.bind(e=>s.fmap(t=>e.concat([t])));return t}function He(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t=t.map(e=>Array.isArray(e)?et(...e):Ie(e));const n=new xe(e=>E(t.map(t=>t.query(e))));return Ae&&(n._steps=ge(...t.map(e=>e._steps))),n}function De(e,t){if(0===(t=t.map(e=>Array.isArray(e)?et(...e):Ie(e))).length)return Pe;if(1===t.length)return t[0];const[s,...n]=t.map(e=>e._steps);return He(...e(Ae?s.maximum(...n):void 0,t))}function Ve(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return De((e,t)=>t.map(t=>t._steps.eq(e)?t:qn(t,Me(e.sub(t._steps)))),t)}function Fe(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return De((e,t)=>t.map(t=>t._steps.eq(e)?t:qn(Me(e.sub(t._steps)),t)),t)}function Ge(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return De((e,t)=>t.map(t=>{if(t._steps.eq(e))return t;const s=Me(e.sub(t._steps).div(2));return qn(s,t,s)}),t)}function Ue(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];const[r,...a]=s.map(e=>e._steps),o=r.maximum(...a),i={centre:Ge,left:Ve,right:Fe,expand:He,repeat:function(){return An(...arguments).steps(o)}};return e.inhabit(i).fmap(e=>e(...s)).innerJoin().setSteps(o)}function Qe(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(1==(t=t.map(e=>Array.isArray(e)?Ye(...e):Ie(e))).length)return t[0];const n=Ae?ge(...t.map(e=>e._steps)):void 0;return new xe(function(e){const s=e.span,n=k(s.begin.sam(),t.length),r=t[n];if(!r)return[];const a=s.begin.floor().sub(s.begin.div(t.length).floor());return r.withHapTime(e=>e.add(a)).query(e.setSpan(s.withTime(e=>e.sub(a))))}).splitQueries().setSteps(n)}function Ke(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t=t.map(Ie);return new xe(function(e){var s;const n=Math.floor(e.span.begin)%t.length;return(null===(s=t[n])||void 0===s?void 0:s.query(e))||[]}).splitQueries()}function $e(){return Qe(...arguments)}function Ze(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const n=t.reduce((e,t)=>{let[s]=t;return e+s},0);return t=t.map(e=>{let[t,s]=e;return[t,s.fast(t)]}),qn(...t).slow(n)}function Xe(){let e=me(0);for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];for(let r of s)2==r.length&&r.unshift(e),e=r[1];return He(...s.map(t=>{let[s,n,r]=t;return Re(Ie(r)).compress(me(s).div(e),me(n).div(e))})).slow(e).innerJoin()}function Ye(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let n=Qe(...t);return t.length>1&&(n=n._fast(t.length),n._steps=t.length),1==t.length&&t[0].__steps_source&&(t._steps=t[0]._steps),n}function et(){return Ye(...arguments)}function tt(){return Ye(...arguments)}function st(e){return Array.isArray(e)?0==e.length?[Pe,0]:1==e.length?st(e[0]):[Ye(...e.map(e=>st(e)[0])),e.length]:[Ie(e),1]}const nt=P((e,t)=>Ie(t).mask(e)),rt=P((e,t)=>Ie(t).struct(e)),at=P((e,t)=>Ie(t).superimpose(...e)),ot=P((e,t)=>Ie(t).withValue(e)),it=P((e,t)=>Ie(t).bind(e)),ct=P((e,t)=>Ie(t).innerBind(e)),ut=P((e,t)=>Ie(t).outerBind(e)),lt=P((e,t)=>Ie(t).squeezeBind(e)),pt=P((e,t)=>Ie(t).stepBind(e)),ht=P((e,t)=>Ie(t).polyBind(e)),dt=P((e,t)=>Ie(t).set(e)),ft=P((e,t)=>Ie(t).keep(e)),mt=P((e,t)=>Ie(t).keepif(e)),yt=P((e,t)=>Ie(t).add(e)),gt=P((e,t)=>Ie(t).sub(e)),vt=P((e,t)=>Ie(t).mul(e)),bt=P((e,t)=>Ie(t).div(e)),wt=P((e,t)=>Ie(t).mod(e)),_t=P((e,t)=>Ie(t).pow(e)),kt=P((e,t)=>Ie(t).band(e)),At=P((e,t)=>Ie(t).bor(e)),qt=P((e,t)=>Ie(t).bxor(e)),St=P((e,t)=>Ie(t).blshift(e)),xt=P((e,t)=>Ie(t).brshift(e)),Tt=P((e,t)=>Ie(t).lt(e)),zt=P((e,t)=>Ie(t).gt(e)),Ct=P((e,t)=>Ie(t).lte(e)),Bt=P((e,t)=>Ie(t).gte(e)),Ot=P((e,t)=>Ie(t).eq(e)),Et=P((e,t)=>Ie(t).eqt(e)),jt=P((e,t)=>Ie(t).ne(e)),Jt=P((e,t)=>Ie(t).net(e)),Mt=P((e,t)=>Ie(t).and(e)),Pt=P((e,t)=>Ie(t).or(e)),Nt=P((e,t)=>Ie(t).func(e));function Rt(e,s){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e=>e.innerJoin();if(Array.isArray(e)){const t={};for(const o of e)t[o]=Rt(o,s,n,r,a);return t}const o=s.length;var i;return i=n?function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const c=(n=n.map(Ie))[n.length-1];let u;if(1===o)u=s(c);else{const e=n.slice(0,-1);if(e.every(e=>null!=e.__pure)){const n=e.map(e=>e.__pure),r=e.filter(e=>e.__pure_loc).map(e=>e.__pure_loc);u=s(...n,c),u=u.withContext(e=>{const s=(e.locations||[]).concat(r);return t(t({},e),{},{locations:s})})}else{const[t,...n]=e;let r=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s(...t,c)};r=P(r,null,o-1),u=a(n.reduce((e,t)=>e.appLeft(t),t.fmap(r)))}}return r&&(u._steps=c._steps),u}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t=t.map(Ie);const a=s(...t);return r&&(a._steps=t[t.length-1]._steps),a},xe.prototype[e]=function(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];if(2===o&&1!==s.length)s=[et(...s)];else if(o!==s.length+1)throw new Error(".".concat(e,"() expects ").concat(o-1," inputs but got ").concat(s.length,"."));return s=s.map(Ie),i(...s,this)},o>1&&(xe.prototype["_"+e]=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const a=s(...t,this);return r&&a.setSteps(this._steps),a}),P(i,null,o)}function Lt(e,t){return Rt(e,t,!(arguments.length>2&&void 0!==arguments[2])||arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:e=>e.stepJoin())}const It=Rt("round",function(e){return e.asNumber().fmap(e=>Math.round(e))}),Wt=Rt("floor",function(e){return e.asNumber().fmap(e=>Math.floor(e))}),Ht=Rt("ceil",function(e){return e.asNumber().fmap(e=>Math.ceil(e))}),Dt=Rt("toBipolar",function(e){return e.fmap(e=>2*e-1)}),Vt=Rt("fromBipolar",function(e){return e.fmap(e=>(e+1)/2)}),Ft=Rt("range",function(e,t,s){return s.mul(t-e).add(e)}),Gt=Rt("rangex",function(e,t,s){return s._range(Math.log(e),Math.log(t)).fmap(Math.exp)}),Ut=Rt("range2",function(e,t,s){return s.fromBipolar()._range(e,t)}),Qt=Rt("ratio",e=>e.fmap(e=>Array.isArray(e)?e.slice(1).reduce((e,t)=>e/t,e[0]):e)),Kt=Rt("compress",function(e,t,s){return e=me(e),t=me(t),e.gt(t)||e.gt(1)||t.gt(1)||e.lt(0)||t.lt(0)?Pe:s._fastGap(me(1).div(t.sub(e)))._late(e)}),{compressSpan:$t,compressspan:Zt}=Rt(["compressSpan","compressspan"],function(e,t){return t._compress(e.begin,e.end)}),{fastGap:Xt,fastgap:Yt}=Rt(["fastGap","fastgap"],function(e,t){return t.withQuerySpanMaybe(function(t){const s=t.begin.sam(),n=t.begin.sub(s).mul(e).min(1),r=t.end.sub(s).mul(e).min(1);if(!(n>=1))return new ve(s.add(n),s.add(r))}).withHap(function(t){const s=t.part.begin,n=t.part.end,r=s.sam(),a=s.sub(r).div(e).min(1),o=n.sub(r).div(e).min(1),i=new ve(r.add(a),r.add(o)),c=t.whole?new ve(i.begin.sub(s.sub(t.whole.begin).div(e)),i.end.add(t.whole.end.sub(n).div(e))):void 0;return new be(c,i,t.value,t.context)}).splitQueries()}),es=Rt("focus",function(e,t,s){return e=me(e),t=me(t),s._early(e.sam())._fast(me(1).div(t.sub(e)))._late(e)}),{focusSpan:ts,focusspan:ss}=Rt(["focusSpan","focusspan"],function(e,t){return t._focus(e.begin,e.end)}),ns=Rt("ply",function(e,t){const s=t.fmap(t=>Re(t)._fast(e)).squeezeJoin();return Ae&&(s._steps=me(e).mulmaybe(t._steps)),s}),{fast:rs,density:as}=Rt(["fast","density"],function(e,t){return 0===e?Pe:(e=me(e),t.withQueryTime(t=>t.mul(e)).withHapTime(t=>t.div(e)).setSteps(t._steps))},!0,!0),os=Rt("hurry",function(e,t){return t._fast(e).mul(Re({speed:e}))}),{slow:is,sparsity:cs}=Rt(["slow","sparsity"],function(e,t){return 0===e?Pe:t._fast(me(1).div(e))}),us=Rt("inside",function(e,t,s){return t(s._slow(e))._fast(e)}),ls=Rt("outside",function(e,t,s){return t(s._fast(e))._slow(e)}),ps=Rt("lastOf",function(e,t,s){const n=Array(e-1).fill(s);return n.push(t(s)),Ke(...n)}),{firstOf:hs,every:ds}=Rt(["firstOf","every"],function(e,t,s){const n=Array(e-1).fill(s);return n.unshift(t(s)),Ke(...n)}),fs=Rt("apply",function(e,t){return e(t)}),ms=Rt("cpm",function(e,t){return t._fast(e/60/1)}),ys=Rt("early",function(e,t){return e=me(e),t.withQueryTime(t=>t.add(e)).withHapTime(t=>t.sub(e))},!0,!0),gs=Rt("late",function(e,t){return e=me(e),t._early(me(0).sub(e))},!0,!0),vs=Rt("zoom",function(e,t,s){var n;if(t=me(t),(e=me(e)).gte(t))return Ne;const r=t.sub(e),a=Ae?null===(n=s._steps)||void 0===n?void 0:n.mulmaybe(r):void 0;return s.withQuerySpan(t=>t.withCycle(t=>t.mul(r).add(e))).withHapSpan(t=>t.withCycle(t=>t.sub(e).div(r))).splitQueries().setSteps(a)}),{zoomArc:bs,zoomarc:ws}=Rt(["zoomArc","zoomarc"],function(e,t){return t.zoom(e.begin,e.end)}),_s=Rt("bite",(e,t,s)=>t.fmap(e=>t=>{const n=me(e).div(t).mod(1),r=n.add(me(1).div(t));return s.zoom(n,r)}).appLeft(e).squeezeJoin(),!1),ks=Rt("linger",function(e,t){return 0==e?Pe:e<0?t._zoom(e.add(1),1)._slow(e):t._zoom(0,e)._slow(e)},!0,!0),{segment:As,seg:qs}=Rt(["segment","seg"],function(e,t){return t.struct(Re(!0)._fast(e)).setSteps(e)}),Ss=Rt("swingBy",(e,t,s)=>s.inside(t,gs(tt(0,e/2)))),xs=Rt("swing",(e,t)=>t.swingBy(1/3,e)),{invert:Ts,inv:zs}=Rt(["invert","inv"],function(e){return e.fmap(e=>!e)},!0,!0),Cs=Rt("when",function(e,t,s){return e?t(s):s}),Bs=Rt("off",function(e,t,s){return He(s,t(s.late(e)))}),Os=Rt("brak",function(e){return e.when(Qe(!1,!0),e=>Ye(e,Pe)._late(.25))}),Es=Rt("rev",function(e){return new xe(function(t){const s=t.span,n=s.begin.sam(),r=s.begin.nextSam(),a=function(e){const t=e.withTime(e=>n.add(r.sub(e))),s=t.begin;return t.begin=t.end,t.end=s,t};return e.query(t.setSpan(a(s))).map(e=>e.withSpan(a))}).splitQueries()},!1,!0),js=Rt("pressBy",function(e,t){return t.fmap(t=>Re(t).compress(e,1)).squeezeJoin()}),Js=Rt("press",function(e){return e._pressBy(.5)});xe.prototype.hush=function(){return Pe};const Ms=Rt("palindrome",function(e){return e.lastOf(2,Es)},!0,!0),{juxBy:Ps,juxby:Ns}=Rt(["juxBy","juxby"],function(e,t,s){e/=2;const n=function(e,t,s){return t in e?e[t]:s},r=s.withValue(t=>Object.assign({},t,{pan:n(t,"pan",.5)-e})),a=t(s.withValue(t=>Object.assign({},t,{pan:n(t,"pan",.5)+e})));return He(r,a).setSteps(Ae?ge(r._steps,a._steps):void 0)}),Rs=Rt("jux",function(e,t){return t._juxBy(1,e,t)}),{echoWith:Ls,echowith:Is,stutWith:Ws,stutwith:Hs}=Rt(["echoWith","echowith","stutWith","stutwith"],function(e,t,s,n){return He(...M(0,e-1).map(e=>s(n.late(me(t).mul(e)),e)))}),Ds=Rt("echo",function(e,t,s,n){return n._echoWith(e,t,(e,t)=>e.gain(Math.pow(s,t)))}),Vs=Rt("stut",function(e,t,s,n){return n._echoWith(e,s,(e,s)=>e.gain(Math.pow(t,s)))}),Fs=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e=me(e),Qe(...M(0,e.sub(1)).map(n=>s?t.late(me(n).div(e)):t.early(me(n).div(e))))},Gs=Rt("iter",function(e,t){return Fs(e,t,!1)},!0,!0),{iterBack:Us,iterback:Qs}=Rt(["iterBack","iterback"],function(e,t){return Fs(e,t,!0)},!0,!0),{repeatCycles:Ks}=Rt("repeatCycles",function(e,t){return new xe(function(s){const n=s.span.begin.sam(),r=n.div(e).sam(),a=n.sub(r);return s=s.withSpan(e=>e.withTime(e=>e.sub(a))),t.query(s).map(e=>e.withSpan(e=>e.withTime(e=>e.add(a))))}).splitQueries()},!0,!0),$s=function(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=Array(e-1).fill(!1);a.unshift(!0);const o=Fs(e,et(...a),!n);return r||(s=s.repeatCycles(e)),s.when(o,t)},{chunk:Zs,slowchunk:Xs,slowChunk:Ys}=Rt(["chunk","slowchunk","slowChunk"],function(e,t,s){return $s(e,t,s,!1,!1)},!0,!0),{chunkBack:en,chunkback:tn}=Rt(["chunkBack","chunkback"],function(e,t,s){return $s(e,t,s,!0)},!0,!0),{fastchunk:sn,fastChunk:nn}=Rt(["fastchunk","fastChunk"],function(e,t,s){return $s(e,t,s,!1,!0)},!0,!0),{chunkinto:rn,chunkInto:an}=Rt(["chunkinto","chunkInto"],function(e,t,s){return s.into(Ye(!0,...Array(e-1).fill(!1))._iterback(e),t)}),{chunkbackinto:on,chunkBackInto:cn}=Rt(["chunkbackinto","chunkBackInto"],function(e,t,s){return s.into(Ye(!0,...Array(e-1).fill(!1))._iter(e)._early(1),t)}),un=Rt("bypass",function(e,t){return(e=!!parseInt(e))?Pe:t},!0,!0),{ribbon:ln,rib:pn}=Rt(["ribbon","rib"],(e,t,s)=>s.early(e).restart(Re(1).slow(t))),hn=Rt("hsla",(e,t,s,n,r)=>r.color("hsla(".concat(e,"turn,").concat(100*t,"%,").concat(100*s,"%,").concat(n,")"))),dn=Rt("hsl",(e,t,s,n)=>n.color("hsl(".concat(e,"turn,").concat(100*t,"%,").concat(100*s,"%)")));xe.prototype.tag=function(e){return this.withContext(s=>t(t({},s),{},{tags:(s.tags||[]).concat([e])}))};const fn=Rt("filter",(e,t)=>t.withHaps(t=>t.filter(e))),mn=Rt("filterWhen",(e,t)=>t.filter(t=>e(t.whole.begin))),yn=Rt("within",(e,t,s,n)=>He(s(n.filterWhen(s=>s.cyclePos()>=e&&s.cyclePos()<=t)),n.filterWhen(s=>s.cyclePos()<e||s.cyclePos()>t)));function gn(e){const t=e.filter((e,t)=>t.hasSteps).reduce((e,t)=>e.add(t),me(0)),s=O(e.map((e,t)=>t._steps)).reduce((e,t)=>e.add(t),me(0)),n=t.eq(0)?void 0:s.div(t);return e.map(e=>function(e,t){return void 0===t._steps?[e.mulmaybe(n),t]:[t._steps,t]}(...e))}function vn(e){const t=E(e.map(e=>[e.part.begin,e.part.end])),s=te([me(0),me(1),...t]);return V(s).map(t=>[t[1].sub(t[0]),He(...bn(new ve(...t),e).map(e=>e.value.withHap(t=>t.setContext(t.combineContext(e)))))])}function bn(e,t){return O(t.map(t=>wn(e,t)))}function wn(e,t){const s=e.intersection(t.part);if(null!=s)return new be(t.whole,s,t.value,t.context)}xe.prototype.stepJoin=function(){const e=this,t=qn(...gn(vn(e.queryArc(0,1))))._steps;return new xe(function(t){return qn(...gn(vn(e.early(t.span.begin.sam()).query(t.setSpan(new ve(me(0),me(1))))))).query(t)},t)},xe.prototype.stepBind=function(e){return this.fmap(e).stepJoin()};const _n=Rt("pace",function(e,t){return void 0===t._steps?t:t._steps.eq(me(0))?Ne:t._fast(me(e).div(t._steps)).setSteps(e)});function kn(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];const r=s.map(e=>st(e));if(0==r.length)return Pe;0==e&&(e=r[0][1]);const a=[];for(const o of r)0!=o[1]&&(e==o[1]?a.push(o[0]):a.push(o[0]._fast(me(e).div(me(o[1])))));return He(...a)}function An(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(Array.isArray(t[0]))return kn(0,...t);if(0==(t=t.filter(e=>e.hasSteps)).length)return Pe;const n=ge(...t.map(e=>e._steps));if(n.eq(me(0)))return Ne;const r=He(...t.map(e=>e.pace(n)));return r._steps=n,r}function qn(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(0===t.length)return Ne;if((t=t.map(e=>{var t;return Array.isArray(e)?e:[null!==(t=e._steps)&&void 0!==t?t:1,e]})).find(e=>void 0===e[0])){const e=t.map(e=>e[0]).filter(e=>void 0!==e);if(0===e.length)return Ye(...t.map(e=>e[1]));if(e.length===t.length)return Ne;const s=e.reduce((e,t)=>e.add(t),me(0)).div(e.length);for(let n of t)void 0===n[0]&&(n[0]=s)}if(1==t.length)return Ie(t[0][1]).withSteps(e=>t[0][0]);const n=t.map(e=>e[0]).reduce((e,t)=>e.add(t),me(0));let r=me(0);const a=[];for(const[i,c]of t){if(me(i).eq(0))continue;const e=r.add(i);a.push(Ie(c)._compress(r.div(n),e.div(n))),r=e}const o=He(...a);return o._steps=n,o}function Sn(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t=t.map(e=>Array.isArray(e)?e.map(Ie):[Ie(e)]);const n=ge(...t.map(e=>me(e.length)));let r=[];for(let o=0;o<n;++o)r.push(...t.map(e=>0==e.length?Pe:e[o%e.length]));r=r.filter(e=>e.hasSteps&&e._steps>0);const a=r.reduce((e,t)=>e.add(t._steps),me(0));return r=qn(...r),r._steps=a,r}const xn=Lt("take",function(e,t){if(!t.hasSteps||t._steps.lte(0)||(e=me(e)).eq(0))return Ne;const s=e<0;s&&(e=e.abs());const n=e.div(t._steps);return n.lte(0)?Ne:n.gte(1)?t:s?t.zoom(me(1).sub(n),1):t.zoom(0,n)}),Tn=Lt("drop",function(e,t){return t.hasSteps?(e=me(e)).lt(0)?t.take(t._steps.add(e)):t.take(me(0).sub(t._steps.sub(e))):Ne}),zn=Lt("extend",function(e,t){return t.fast(e).expand(e)}),Cn=Lt("expand",function(e,t){return t.withSteps(t=>t.mul(me(e)))}),Bn=Lt("contract",function(e,t){return t.withSteps(t=>t.div(me(e)))});xe.prototype.shrinklist=function(e){const t=this;if(!t.hasSteps)return[t];let[s,n]=Array.isArray(e)?e:[e,t._steps];if(s=me(s),0===n||0===s)return[t];const r=[];if(s>0){const e=me(1).div(t._steps).mul(s);for(let t=0;t<n;++t){const s=e.mul(t);if(s.gt(1))break;r.push([s,1])}}else{s=me(0).sub(s);const e=me(1).div(t._steps).mul(s);for(let t=0;t<n;++t){const s=me(1).sub(e.mul(t));if(s.lt(0))break;r.push([me(0),s])}}return r.map(e=>t.zoom(...e))};const On=(e,t)=>t.shrinklist(e),En=Rt("shrink",function(e,t){if(!t.hasSteps)return Ne;const s=t.shrinklist(e),n=qn(...s);return n._steps=s.reduce((e,t)=>e.add(t._steps),me(0)),n},!0,!1,e=>e.stepJoin()),jn=Rt("grow",function(e,t){if(!t.hasSteps)return Ne;const s=t.shrinklist(me(0).sub(e));s.reverse();const n=qn(...s);return n._steps=s.reduce((e,t)=>e.add(t._steps),me(0)),n},!0,!1,e=>e.stepJoin()),Jn=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];return e.tour(...s)};xe.prototype.tour=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return qn(...[].concat(...t.map((e,s)=>[...t.slice(0,t.length-s),this,...t.slice(t.length-s)]),this,...t))};const Mn=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const n=Qe(...(t=t.filter(e=>e.hasSteps)).map(e=>e._slow(e._steps))),r=ge(...t.map(e=>e._steps));return n._fast(r).setSteps(r)},Pn=qn,Nn=qn,Rn=qn,Ln=Sn,In=An;xe.prototype.s_polymeter=xe.prototype.polymeter;const Wn=En;xe.prototype.s_taper=xe.prototype.shrink;const Hn=On;xe.prototype.s_taperlist=xe.prototype.shrinklist;const Dn=xn;xe.prototype.s_add=xe.prototype.take;const Vn=Tn;xe.prototype.s_sub=xe.prototype.drop;const Fn=Cn;xe.prototype.s_expand=xe.prototype.expand;const Gn=zn;xe.prototype.s_extend=xe.prototype.extend;const Un=Bn;xe.prototype.s_contract=xe.prototype.contract;const Qn=Jn;xe.prototype.s_tour=xe.prototype.tour;const Kn=Mn;xe.prototype.s_zip=xe.prototype.zip;const $n=_n;xe.prototype.steps=xe.prototype.pace;const Zn=Rt("chop",function(e,t){const s=Array.from({length:e},(e,t)=>t).map(t=>({begin:t/e,end:(t+1)/e}));return t.squeezeBind(function(e){return et(s.map(t=>function(e,t){if("begin"in e&&"end"in e&&void 0!==e.begin&&void 0!==e.end){const s=e.end-e.begin;t={begin:e.begin+t.begin*s,end:e.begin+t.end*s}}return Object.assign({},e,t)}(e,t)))}).setSteps(Ae?me(e).mulmaybe(t._steps):void 0)}),Xn=Rt("striate",function(e,t){const s=Qe(...Array.from({length:e},(e,t)=>t).map(t=>({begin:t/e,end:(t+1)/e})));return t.set(s)._fast(e).setSteps(Ae?me(e).mulmaybe(t._steps):void 0)}),Yn=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return t.speed(1/e*s).unit("c").slow(e)},er=Rt("slice",function(e,s,n){return e.innerBind(e=>s.outerBind(s=>n.outerBind(n=>{n=n instanceof Object?n:{s:n};const r=Array.isArray(e)?e[s]:s/e,a=Array.isArray(e)?e[s+1]:(s+1)/e;return Re(t({begin:r,end:a,_slices:e},n))}))).setSteps(s._steps)},!1);xe.prototype.onTriggerTime=function(e){return this.onTrigger((t,s,n,r)=>{const a=r-s;window.setTimeout(()=>{e(t)},1e3*a)},!1)};const tr=Rt("splice",function(e,s,n){const r=er(e,s,n);return new xe(e=>{const s=e.controls._cps||1;return r.query(e).map(e=>e.withValue(n=>t({speed:s/n._slices/e.whole.duration*(n.speed||1),unit:"c"},n)))}).setSteps(s._steps)},!1),{loopAt:sr,loopat:nr}=Rt(["loopAt","loopat"],function(e,t){const s=t._steps?t._steps.div(e):void 0;return new xe(s=>Yn(e,t,s.controls._cps).query(s),s)}),rr=Rt("fit",e=>e.withHaps((e,s)=>e.map(e=>e.withValue(n=>{const r=("end"in n?n.end:1)-("begin"in n?n.begin:0);return t(t({},n),{},{speed:(s.controls._cps||1)/e.whole.duration*r,unit:"c"})})))),{loopAtCps:ar,loopatcps:or}=Rt(["loopAtCps","loopatcps"],function(e,t,s){return Yn(e,s,t)}),ir=e=>Re(1).withValue(()=>Ie(e())).innerJoin();let cr=e=>e<.5?1:1-(e-.5)/.5,ur=(e,t,s)=>{t=Ie(t),e=Ie(e),s=Ie(s);let n=t.fmap(e=>({gain:cr(e)})),r=t.fmap(e=>({gain:cr(1-e)}));return He(e.mul(n),s.mul(r))};xe.prototype.xfade=function(e,t){return ur(this,e,t)};const{beat:lr}=Rt(["beat"],(dr=e=>e.innerJoin(),(e,t,s)=>{e=me(e).mod(t),t=me(t);const n=e.div(t),r=e.add(1).div(t);return dr(s.fmap(e=>Re(e)._compress(n,r)))})),pr=(e,t,s)=>{s=me(s);const n=me(1).div(e.length),r=e=>{const t=[];for(const[s,n]of e.entries())n&&t.push([me(s).div(e.length),n]);return t},a=D((e,t)=>{let[r,a]=e,[o,i]=t;const c=s.mul(o-r).add(r),u=c.add(n);return new ve(c,u)},r(e),r(t));return new xe(function(e){const t=e.span.begin.sam(),s=e.span.cycleArc(),n=[];for(const r of a){const e=r.intersection(s);void 0!==e&&n.push(new be(r.withTime(e=>e.add(t)),e.withTime(e=>e.add(t)),!0))}return n}).splitQueries()},hr=(e,t,s)=>(e=Ie(e),t=Ie(t),s=Ie(s),e.innerBind(e=>t.innerBind(t=>s.innerBind(s=>pr(e,t,s)))));var dr;function fr(e){let s=Array.isArray(e);const n=(e=s?e:[e])[0],r=r=>{let a;if("object"==typeof r&&void 0!==r.value&&(a=t({},r),r=r.value,delete a.value),s&&Array.isArray(r)){const t=a||{};return r.forEach((s,n)=>{n<e.length&&(t[e[n]]=s)}),t}return a?(a[n]=r,a):{[n]:r}},a=function(e,t){return t?typeof e>"u"?t.fmap(r):t.set(Ie(e).withValue(r)):Ie(e).withValue(r)};return xe.prototype[n]=function(e){return a(e,this)},a}const mr=new Map;function yr(e){return mr.has(e)}function gr(e){const t=Array.isArray(e)?e[0]:e;let s={};for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return s[t]=fr(e),mr.set(t,t),r.forEach(e=>{s[e]=s[t],mr.set(e,t),xe.prototype[e]=xe.prototype[t]}),s}const{s:vr,sound:br}=gr(["s","n","gain"],"sound"),{source:wr,src:_r}=gr("source","src"),{n:kr}=gr("n"),{note:Ar}=gr(["note","n"]),{accelerate:qr}=gr("accelerate"),{velocity:Sr}=gr("velocity"),{gain:xr}=gr("gain"),{postgain:Tr}=gr("postgain"),{amp:zr}=gr("amp"),{attack:Cr,att:Br}=gr("attack","att"),{fmh:Or}=gr(["fmh","fmi"],"fmh"),{fmi:Er,fm:jr}=gr(["fmi","fmh"],"fm"),{fmenv:Jr}=gr("fmenv"),{fmattack:Mr}=gr("fmattack"),{fmwave:Pr}=gr("fmwave"),{fmdecay:Nr}=gr("fmdecay"),{fmsustain:Rr}=gr("fmsustain"),{fmrelease:Lr}=gr("fmrelease"),{fmvelocity:Ir}=gr("fmvelocity"),{bank:Wr}=gr("bank"),{analyze:Hr}=gr("analyze"),{fft:Dr}=gr("fft"),{decay:Vr,dec:Fr}=gr("decay","dec"),{sustain:Gr,sus:Ur}=gr("sustain","sus"),{release:Qr,rel:Kr}=gr("release","rel"),{hold:$r}=gr("hold"),{bandf:Zr,bpf:Xr,bp:Yr}=gr(["bandf","bandq","bpenv"],"bpf","bp"),{bandq:ea,bpq:ta}=gr("bandq","bpq"),{begin:sa}=gr("begin"),{end:na}=gr("end"),{loop:ra}=gr("loop"),{loopBegin:aa,loopb:oa}=gr("loopBegin","loopb"),{loopEnd:ia,loope:ca}=gr("loopEnd","loope"),{crush:ua}=gr("crush"),{coarse:la}=gr("coarse"),{tremolo:pa}=gr(["tremolo","tremolodepth","tremoloskew","tremolophase"],"trem"),{tremolosync:ha}=gr(["tremolosync","tremolodepth","tremoloskew","tremolophase"],"tremsync"),{tremolodepth:da}=gr("tremolodepth","tremdepth"),{tremoloskew:fa}=gr("tremoloskew","tremskew"),{tremolophase:ma}=gr("tremolophase","tremphase"),{tremoloshape:ya}=gr("tremoloshape","tremshape"),{duck:ga}=gr("duckorbit","duck"),{duckdepth:va}=gr("duckdepth"),{duckattack:ba}=gr("duckattack","duckatt"),{drive:wa}=gr("drive"),{byteBeatExpression:_a,bbexpr:ka}=gr("byteBeatExpression","bbexpr"),{byteBeatStartTime:Aa,bbst:qa}=gr("byteBeatStartTime","bbst"),{channels:Sa,ch:xa}=gr("channels","ch"),{pw:Ta}=gr(["pw","pwrate","pwsweep"]),{pwrate:za}=gr("pwrate"),{pwsweep:Ca}=gr("pwsweep"),{phaserrate:Ba,ph:Oa,phaser:Ea}=gr(["phaserrate","phaserdepth","phasercenter","phasersweep"],"ph","phaser"),{phasersweep:ja,phs:Ja}=gr("phasersweep","phs"),{phasercenter:Ma,phc:Pa}=gr("phasercenter","phc"),{phaserdepth:Na,phd:Ra,phasdp:La}=gr("phaserdepth","phd","phasdp"),{channel:Ia}=gr("channel"),{cut:Wa}=gr("cut"),{cutoff:Ha,ctf:Da,lpf:Va,lp:Fa}=gr(["cutoff","resonance","lpenv"],"ctf","lpf","lp"),{lpenv:Ga,lpe:Ua}=gr("lpenv","lpe"),{hpenv:Qa,hpe:Ka}=gr("hpenv","hpe"),{bpenv:$a,bpe:Za}=gr("bpenv","bpe"),{lpattack:Xa,lpa:Ya}=gr("lpattack","lpa"),{hpattack:eo,hpa:to}=gr("hpattack","hpa"),{bpattack:so,bpa:no}=gr("bpattack","bpa"),{lpdecay:ro,lpd:ao}=gr("lpdecay","lpd"),{hpdecay:oo,hpd:io}=gr("hpdecay","hpd"),{bpdecay:co,bpd:uo}=gr("bpdecay","bpd"),{lpsustain:lo,lps:po}=gr("lpsustain","lps"),{hpsustain:ho,hps:fo}=gr("hpsustain","hps"),{bpsustain:mo,bps:yo}=gr("bpsustain","bps"),{lprelease:go,lpr:vo}=gr("lprelease","lpr"),{hprelease:bo,hpr:wo}=gr("hprelease","hpr"),{bprelease:_o,bpr:ko}=gr("bprelease","bpr"),{ftype:Ao}=gr("ftype"),{fanchor:qo}=gr("fanchor"),{vib:So,vibrato:xo,v:To}=gr(["vib","vibmod"],"vibrato","v"),{noise:zo}=gr("noise"),{vibmod:Co,vmod:Bo}=gr(["vibmod","vib"],"vmod"),{hcutoff:Oo,hpf:Eo,hp:jo}=gr(["hcutoff","hresonance","hpenv"],"hpf","hp"),{hresonance:Jo,hpq:Mo}=gr("hresonance","hpq"),{resonance:Po,lpq:No}=gr("resonance","lpq"),{djf:Ro}=gr("djf"),{delay:Lo}=gr(["delay","delaytime","delayfeedback"]),{delayfeedback:Io,delayfb:Wo,dfb:Ho}=gr("delayfeedback","delayfb","dfb"),{delaytime:Do,delayt:Vo,dt:Fo}=gr("delaytime","delayt","dt"),{delaysync:Go}=gr("delaysync"),{lock:Uo}=gr("lock"),{detune:Qo,det:Ko}=gr("detune","det"),{unison:$o}=gr("unison"),{spread:Zo}=gr("spread"),{dry:Xo}=gr("dry"),{fadeTime:Yo,fadeOutTime:ei}=gr("fadeTime","fadeOutTime"),{fadeInTime:ti}=gr("fadeInTime"),{freq:si}=gr("freq"),{pattack:ni,patt:ri}=gr("pattack","patt"),{pdecay:ai,pdec:oi}=gr("pdecay","pdec"),{psustain:ii,psus:ci}=gr("psustain","psus"),{prelease:ui,prel:li}=gr("prelease","prel"),{penv:pi}=gr("penv"),{pcurve:hi}=gr("pcurve"),{panchor:di}=gr("panchor"),{gate:fi,gat:mi}=gr("gate","gat"),{leslie:yi}=gr("leslie"),{lrate:gi}=gr("lrate"),{lsize:vi}=gr("lsize"),{activeLabel:bi}=gr("activeLabel"),{label:wi}=gr(["label","activeLabel"]),{degree:_i}=gr("degree"),{mtranspose:ki}=gr("mtranspose"),{ctranspose:Ai}=gr("ctranspose"),{harmonic:qi}=gr("harmonic"),{stepsPerOctave:Si}=gr("stepsPerOctave"),{octaveR:xi}=gr("octaveR"),{nudge:Ti}=gr("nudge"),{octave:zi}=gr("octave"),{orbit:Ci}=gr("orbit"),{overgain:Bi}=gr("overgain"),{overshape:Oi}=gr("overshape"),{pan:Ei}=gr("pan"),{panspan:ji}=gr("panspan"),{pansplay:Ji}=gr("pansplay"),{panwidth:Mi}=gr("panwidth"),{panorient:Pi}=gr("panorient"),{rate:Ni}=gr("rate"),{slide:Ri}=gr("slide"),{semitone:Li}=gr("semitone"),{voice:Ii}=gr("voice"),{chord:Wi}=gr("chord"),{dictionary:Hi,dict:Di}=gr("dictionary","dict"),{anchor:Vi}=gr("anchor"),{offset:Fi}=gr("offset"),{octaves:Gi}=gr("octaves"),{mode:Ui}=gr(["mode","anchor"]),{room:Qi}=gr(["room","size"]),{roomlp:Ki,rlp:$i}=gr("roomlp","rlp"),{roomdim:Zi,rdim:Xi}=gr("roomdim","rdim"),{roomfade:Yi,rfade:ec}=gr("roomfade","rfade"),{ir:tc,iresponse:sc}=gr(["ir","i"],"iresponse"),{irspeed:nc}=gr("irspeed"),{irbegin:rc}=gr("irbegin"),{roomsize:ac,size:oc,sz:ic,rsize:cc}=gr("roomsize","size","sz","rsize"),{shape:uc}=gr(["shape","shapevol"]),{distort:lc,dist:pc}=gr(["distort","distortvol"],"dist"),{compressor:hc}=gr(["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]),{compressorKnee:dc}=gr("compressorKnee"),{compressorRatio:fc}=gr("compressorRatio"),{compressorAttack:mc}=gr("compressorAttack"),{compressorRelease:yc}=gr("compressorRelease"),{speed:gc}=gr("speed"),{stretch:vc}=gr("stretch"),{unit:bc}=gr("unit"),{squiz:wc}=gr("squiz"),{vowel:_c}=gr("vowel"),{waveloss:kc}=gr("waveloss"),{density:Ac}=gr("density"),{expression:qc}=gr("expression"),{sustainpedal:Sc}=gr("sustainpedal"),{fshift:xc}=gr("fshift"),{fshiftnote:Tc}=gr("fshiftnote"),{fshiftphase:zc}=gr("fshiftphase"),{triode:Cc}=gr("triode"),{krush:Bc}=gr("krush"),{kcutoff:Oc}=gr("kcutoff"),{octer:Ec}=gr("octer"),{octersub:jc}=gr("octersub"),{octersubsub:Jc}=gr("octersubsub"),{ring:Mc}=gr("ring"),{ringf:Pc}=gr("ringf"),{ringdf:Nc}=gr("ringdf"),{freeze:Rc}=gr("freeze"),{xsdelay:Lc}=gr("xsdelay"),{tsdelay:Ic}=gr("tsdelay"),{real:Wc}=gr("real"),{imag:Hc}=gr("imag"),{enhance:Dc}=gr("enhance"),{partials:Vc}=gr("partials"),{comb:Fc}=gr("comb"),{smear:Gc}=gr("smear"),{scram:Uc}=gr("scram"),{binshift:Qc}=gr("binshift"),{hbrick:Kc}=gr("hbrick"),{lbrick:$c}=gr("lbrick"),{frameRate:Zc}=gr("frameRate"),{frames:Xc}=gr("frames"),{hours:Yc}=gr("hours"),{minutes:eu}=gr("minutes"),{seconds:tu}=gr("seconds"),{songPtr:su}=gr("songPtr"),{uid:nu}=gr("uid"),{val:ru}=gr("val"),{cps:au}=gr("cps"),{clip:ou,legato:iu}=gr("clip","legato"),{duration:cu,dur:uu}=gr("duration","dur"),{zrand:lu}=gr("zrand"),{curve:pu}=gr("curve"),{deltaSlide:hu}=gr("deltaSlide"),{pitchJump:du}=gr("pitchJump"),{pitchJumpTime:fu}=gr("pitchJumpTime"),{lfo:mu,repeatTime:yu}=gr("lfo","repeatTime"),{znoise:gu}=gr("znoise"),{zmod:vu}=gr("zmod"),{zcrush:bu}=gr("zcrush"),{zdelay:wu}=gr("zdelay"),{zzfx:_u}=gr("zzfx"),{color:ku,colour:Au}=gr(["color","colour"]);let qu=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.reduce((e,t)=>Object.assign(e,{[t]:fr(t)}),{})};const Su=Rt("adsr",(e,t)=>{e=Array.isArray(e)?e:[e];const[s,n,r,a]=e;return t.set({attack:s,decay:n,sustain:r,release:a})}),xu=Rt("ad",(e,t)=>{e=Array.isArray(e)?e:[e];const[s,n=s]=e;return t.attack(s).decay(n)}),Tu=Rt("ds",(e,t)=>{e=Array.isArray(e)?e:[e];const[s,n=0]=e;return t.set({decay:s,sustain:n})}),zu=Rt("ar",(e,t)=>{e=Array.isArray(e)?e:[e];const[s,n=s]=e;return t.set({attack:s,release:n})}),{midichan:Cu}=gr("midichan"),{midimap:Bu}=gr("midimap"),{midiport:Ou}=gr("midiport"),{midicmd:Eu}=gr("midicmd"),ju=Rt("control",(e,t)=>{if(!Array.isArray(e))throw new Error("control expects an array of [ccn, ccv]");const[s,n]=e;return t.ccn(s).ccv(n)}),{ccn:Ju}=gr("ccn"),{ccv:Mu}=gr("ccv"),{ctlNum:Pu}=gr("ctlNum"),{nrpnn:Nu}=gr("nrpnn"),{nrpv:Ru}=gr("nrpv"),{progNum:Lu}=gr("progNum"),Iu=Rt("sysex",(e,t)=>{if(!Array.isArray(e))throw new Error("sysex expects an array of [id, data]");const[s,n]=e;return t.sysexid(s).sysexdata(n)}),{sysexid:Wu}=gr("sysexid"),{sysexdata:Hu}=gr("sysexdata"),{midibend:Du}=gr("midibend"),{miditouch:Vu}=gr("miditouch"),{polyTouch:Fu}=gr("polyTouch"),Gu=e=>mr.has(e)?mr.get(e):e,Uu=Rt("as",(e,t)=>(e=Array.isArray(e)?e:[e],t.fmap(t=>(t=Array.isArray(t)?t:[t],t=Object.fromEntries(e.map((e,s)=>[Gu(e),t[s]])))))),Qu=Rt("scrub",(e,t)=>e.outerBind(e=>{Array.isArray(e)||(e=[e]);const[s,n=1]=e;return t.begin(s).mul(gc(n)).clip(1)}),!1),Ku=Object.freeze(Object.defineProperty({__proto__:null,accelerate:qr,activeLabel:bi,ad:xu,adsr:Su,amp:zr,analyze:Hr,anchor:Vi,ar:zu,as:Uu,att:Br,attack:Cr,bandf:Zr,bandq:ea,bank:Wr,bbexpr:ka,bbst:qa,begin:sa,binshift:Qc,bp:Yr,bpa:no,bpattack:so,bpd:uo,bpdecay:co,bpe:Za,bpenv:$a,bpf:Xr,bpq:ta,bpr:ko,bprelease:_o,bps:yo,bpsustain:mo,byteBeatExpression:_a,byteBeatStartTime:Aa,ccn:Ju,ccv:Mu,ch:xa,channel:Ia,channels:Sa,chord:Wi,clip:ou,coarse:la,color:ku,colour:Au,comb:Fc,compressor:hc,compressorAttack:mc,compressorKnee:dc,compressorRatio:fc,compressorRelease:yc,control:ju,cps:au,createParam:fr,createParams:qu,crush:ua,ctf:Da,ctlNum:Pu,ctranspose:Ai,curve:pu,cut:Wa,cutoff:Ha,dec:Fr,decay:Vr,degree:_i,delay:Lo,delayfb:Wo,delayfeedback:Io,delaysync:Go,delayt:Vo,delaytime:Do,deltaSlide:hu,density:Ac,det:Ko,detune:Qo,dfb:Ho,dict:Di,dictionary:Hi,dist:pc,distort:lc,djf:Ro,drive:wa,dry:Xo,ds:Tu,dt:Fo,duck:ga,duckattack:ba,duckdepth:va,dur:uu,duration:cu,end:na,enhance:Dc,expression:qc,fadeInTime:ti,fadeOutTime:ei,fadeTime:Yo,fanchor:qo,fft:Dr,fm:jr,fmattack:Mr,fmdecay:Nr,fmenv:Jr,fmh:Or,fmi:Er,fmrelease:Lr,fmsustain:Rr,fmvelocity:Ir,fmwave:Pr,frameRate:Zc,frames:Xc,freeze:Rc,freq:si,fshift:xc,fshiftnote:Tc,fshiftphase:zc,ftype:Ao,gain:xr,gat:mi,gate:fi,getControlName:Gu,harmonic:qi,hbrick:Kc,hcutoff:Oo,hold:$r,hours:Yc,hp:jo,hpa:to,hpattack:eo,hpd:io,hpdecay:oo,hpe:Ka,hpenv:Qa,hpf:Eo,hpq:Mo,hpr:wo,hprelease:bo,hps:fo,hpsustain:ho,hresonance:Jo,imag:Hc,ir:tc,irbegin:rc,iresponse:sc,irspeed:nc,isControlName:yr,kcutoff:Oc,krush:Bc,label:wi,lbrick:$c,legato:iu,leslie:yi,lfo:mu,lock:Uo,loop:ra,loopBegin:aa,loopEnd:ia,loopb:oa,loope:ca,lp:Fa,lpa:Ya,lpattack:Xa,lpd:ao,lpdecay:ro,lpe:Ua,lpenv:Ga,lpf:Va,lpq:No,lpr:vo,lprelease:go,lps:po,lpsustain:lo,lrate:gi,lsize:vi,midibend:Du,midichan:Cu,midicmd:Eu,midimap:Bu,midiport:Ou,miditouch:Vu,minutes:eu,mode:Ui,mtranspose:ki,n:kr,noise:zo,note:Ar,nrpnn:Nu,nrpv:Ru,nudge:Ti,octave:zi,octaveR:xi,octaves:Gi,octer:Ec,octersub:jc,octersubsub:Jc,offset:Fi,orbit:Ci,overgain:Bi,overshape:Oi,pan:Ei,panchor:di,panorient:Pi,panspan:ji,pansplay:Ji,panwidth:Mi,partials:Vc,patt:ri,pattack:ni,pcurve:hi,pdec:oi,pdecay:ai,penv:pi,ph:Oa,phasdp:La,phaser:Ea,phasercenter:Ma,phaserdepth:Na,phaserrate:Ba,phasersweep:ja,phc:Pa,phd:Ra,phs:Ja,pitchJump:du,pitchJumpTime:fu,polyTouch:Fu,postgain:Tr,prel:li,prelease:ui,progNum:Lu,psus:ci,psustain:ii,pw:Ta,pwrate:za,pwsweep:Ca,rate:Ni,rdim:Xi,real:Wc,registerControl:gr,rel:Kr,release:Qr,repeatTime:yu,resonance:Po,rfade:ec,ring:Mc,ringdf:Nc,ringf:Pc,rlp:$i,room:Qi,roomdim:Zi,roomfade:Yi,roomlp:Ki,roomsize:ac,rsize:cc,s:vr,scram:Uc,scrub:Qu,seconds:tu,semitone:Li,shape:uc,size:oc,slide:Ri,smear:Gc,songPtr:su,sound:br,source:wr,speed:gc,spread:Zo,squiz:wc,src:_r,stepsPerOctave:Si,stretch:vc,sus:Ur,sustain:Gr,sustainpedal:Sc,sysex:Iu,sysexdata:Hu,sysexid:Wu,sz:ic,tremolo:pa,tremolodepth:da,tremolophase:ma,tremoloshape:ya,tremoloskew:fa,tremolosync:ha,triode:Cc,tsdelay:Ic,uid:nu,unison:$o,unit:bc,v:To,val:ru,velocity:Sr,vib:So,vibmod:Co,vibrato:xo,vmod:Bo,voice:Ii,vowel:_c,waveloss:kc,xsdelay:Lc,zcrush:bu,zdelay:wu,zmod:vu,znoise:gu,zrand:lu,zzfx:_u},Symbol.toStringTag,{value:"Module"})),$u=function(e,t){const[s,n]=e;return Math.min(s,n)<=1?[e,t]:$u(...s>n?function(e,t){const[s,n]=e,[r,a]=t,[o,i]=H(n,r);return[[n,s-n],[D((e,t)=>e.concat(t),o,a),i]]}(e,t):function(e,t){const[s,n]=e,[r,a]=t,[o,i]=H(s,a);return[[s,n-s],[D((e,t)=>e.concat(t),r,o),i]]}(e,t))},Zu=function(e,t){const s=e<0,n=Math.abs(e),r=t-n,a=Array(n).fill([1]),o=Array(r).fill([0]),i=$u([n,r],[a,o]),c=E(i[1][0]).concat(E(i[1][1]));return s?c.map(e=>1-e):c},Xu=function(e,t,s){const n=Zu(e,t);return s?z(n,-s):n},Yu=Rt("euclid",function(e,t,s){return s.struct(Xu(e,t,0))}),el=Rt("e",function(e,t){Array.isArray(e)||(e=[e]);const[s,n=s,r=0]=e;return t.struct(Xu(s,n,r))}),{euclidrot:tl,euclidRot:sl}=Rt(["euclidrot","euclidRot"],function(e,t,s,n){return n.struct(Xu(e,t,s))}),nl=function(e,t,s,n){if(e<1)return Pe;const r=Xu(e,t,0).join("").split("1").slice(1).map(e=>[e.length+1,!0]);return n.struct(Nn(...r)).late(me(s).div(t))},rl=Rt(["euclidLegato"],function(e,t,s){return nl(e,t,0,s)}),al=Rt(["euclidLegatoRot"],function(e,t,s,n){return nl(e,t,s,n)}),{euclidish:ol,eish:il}=Rt(["euclidish","eish"],function(e,t,s,n){const r=pr(Zu(e,t),new Array(e).fill(1),s);return n.struct(r).setSteps(t)});function cl(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.05,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:globalThis.setInterval,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:globalThis.clearInterval,i=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=0,u=0;r=r||n/2;const l=()=>{const a=e(),o=a+n+r;for(0===u&&(u=a+.01);u<o;)u=i?Math.round(1e4*u)/1e4:u,t(u,s,c,a),u+=s,c++};let p;const h=()=>{void 0!==p&&o(p),p=void 0};return{setDuration:e=>s=e(s),start:()=>{h(),l(),p=a(l,1e3*n)},stop:()=>{c=0,u=0,h()},pause:()=>h(),duration:s,interval:n,getPhase:()=>u,minLatency:.01}}function ul(e){return new xe(t=>[new be(void 0,t.span,e)])}const ll=e=>new xe(t=>[new be(void 0,t.span,e(t.span.begin))]),pl=ll(e=>e%1),hl=pl.toBipolar(),dl=ll(e=>1-e%1),fl=dl.toBipolar(),ml=ll(e=>Math.sin(2*Math.PI*e)),yl=ml.fromBipolar(),gl=yl._early(me(1).div(4)),vl=ml._early(me(1).div(4)),bl=ll(e=>Math.floor(2*e%2)),wl=bl.toBipolar(),_l=Ye(pl,dl),kl=Ye(hl,fl),Al=Ye(dl,pl),ql=Ye(fl,hl),Sl=ll(j);let xl=0,Tl=0;typeof window<"u"&&document.addEventListener("mousemove",e=>{xl=e.clientY/document.body.clientHeight,Tl=e.clientX/document.body.clientWidth});const zl=ll(()=>xl),Cl=ll(()=>xl),Bl=ll(()=>Tl),Ol=ll(()=>Tl),El=e=>{const t=e<<13^e,s=t>>17^t;return s<<5^s},jl=e=>El(Math.trunc(536870912*(e=>e-Math.trunc(e))(e/300))),Jl=e=>e%536870912/536870912,Ml=e=>Math.abs(Jl(jl(e))),Pl=(e,t)=>((e,t)=>{const s=[];for(let n=0;n<t;++n)s.push(Jl(e)),e=El(e);return s})(jl(e),t),Nl=e=>pl.range(0,e).round().segment(e),Rl=e=>{const t=Ie(e).log2(0).floor().add(1);return Ll(e,t)},Ll=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;t=Ie(t);const s=Nl(t).mul(-1).add(t.sub(1));return Ie(e).segment(t).brshift(s).band(Re(1))},Il=e=>ll(t=>Pl(t.floor().add(.5),e).map((e,t)=>[e,t]).sort((e,t)=>(e[0]>t[0])-(e[0]<t[0])).map(e=>e[1])[t.cyclePos().mul(e).floor()%e])._segment(e),Wl=(e,t,s)=>{const n=[...Array(t).keys()].map(e=>s.zoom(me(e).div(t),me(e+1).div(t)));return e.fmap(e=>n[e].repeatCycles(t)._fast(t)).innerJoin()},Hl=Rt("shuffle",(e,t)=>Wl(Il(e),e,t)),Dl=Rt("scramble",(e,t)=>Wl(Kl(e)._segment(e),e,t)),Vl=ll(Ml),Fl=Vl.toBipolar(),Gl=e=>Vl.fmap(t=>t<e),Ul=e=>Ie(e).fmap(Gl).innerJoin(),Ql=Gl(.5),Kl=e=>Vl.fmap(t=>Math.trunc(t*e)),$l=e=>Ie(e).fmap(Kl).innerJoin(),Zl=(e,t)=>0==(t=t.map(Ie)).length?Pe:e.range(0,t.length).fmap(e=>{const s=Math.min(Math.max(Math.floor(e),0),t.length-1);return t[s]}),Xl=(e,t)=>Zl(e,t).outerJoin(),Yl=(e,t)=>Zl(e,t).innerJoin(),ep=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Xl(Vl,t)},tp=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Yl(Vl,t)},sp=ep;xe.prototype.choose=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Xl(this,t)},xe.prototype.choose2=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Xl(this.fromBipolar(),t)};const np=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Yl(Vl.segment(1),t)},rp=np,ap=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];const r=s.map(e=>Ie(e[0])),a=[];let o=Re(0);for(const c of s)o=o.add(c[1]),a.push(o);const i=We(a);return e.bind(function(e){const t=o.mul(e);return i.fmap(e=>t=>r[e.findIndex(e=>e>t,e)]).appLeft(t)})},op=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(){return ap(...arguments).outerJoin()}(Vl,...t)},ip=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return ap(Vl.segment(1),...t).innerJoin()},cp=ip;function up(e){let t=Math.floor(e),s=t+1;return(n=e-t,e=>t=>e+(e=>6*e**5-15*e**4+10*e**3)(n)*(t-e))(Ml(t))(Ml(s));var n}const lp=e=>e.fmap(up);function pp(e){const t=Math.floor(e),s=t+1,n=Ml(t),r=Ml(s)+n;return((a=n)+(r-a)*((e-t)/(s-t)))/2;var a}const hp=e=>e.fmap(pp),dp=lp(Sl.fmap(e=>Number(e))),fp=hp(Sl.fmap(e=>Number(e))),mp=Rt("degradeByWith",(e,t,s)=>s.fmap(e=>t=>e).appLeft(e.filterValues(e=>e>t)),!0,!0),yp=Rt("degradeBy",function(e,t){return t._degradeByWith(Vl,e)},!0,!0),gp=Rt("degrade",e=>e._degradeBy(.5),!0,!0),vp=Rt("undegradeBy",function(e,t){return t._degradeByWith(Vl.fmap(e=>1-e),e)},!0,!0),bp=Rt("undegrade",e=>e._undegradeBy(.5),!0,!0),wp=Rt("sometimesBy",function(e,t,s){return Ie(e).fmap(e=>He(s._degradeBy(e),t(s._undegradeBy(1-e)))).innerJoin()}),_p=Rt("sometimes",function(e,t){return t._sometimesBy(.5,e)}),kp=Rt("someCyclesBy",function(e,t,s){return Ie(e).fmap(e=>He(s._degradeByWith(Vl._segment(1),e),t(s._degradeByWith(Vl.fmap(e=>1-e)._segment(1),1-e)))).innerJoin()}),Ap=Rt("someCycles",function(e,t){return t._someCyclesBy(.5,e)}),qp=Rt("often",function(e,t){return t.sometimesBy(.75,e)}),Sp=Rt("rarely",function(e,t){return t.sometimesBy(.25,e)}),xp=Rt("almostNever",function(e,t){return t.sometimesBy(.1,e)}),Tp=Rt("almostAlways",function(e,t){return t.sometimesBy(.9,e)}),zp=Rt("never",function(e,t){return t}),Cp=Rt("always",function(e,t){return e(t)});function Bp(e){!1===Array.isArray(e)&&(e=[e]);const t=de();return e.every(e=>{var s;const n=null!==(s=pe.get(e))&&void 0!==s?s:e;return t[n]})}const Op=Rt("whenKey",function(e,t,s){return s.when(Bp(e),t)}),Ep=Rt("keyDown",function(e){return e.fmap(Bp)}),jp=function(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=Array.isArray(e),r=Object.keys(e).length;return e=oe(e,Ie),0===r?Pe:t.fmap(t=>{let a=t;return n&&(a=s?Math.round(a)%r:F(Math.round(a),0,e.length-1)),e[a]})},Jp=function(e,t){return Array.isArray(t)&&([t,e]=[e,t]),Mp(e,t)},Mp=Rt("pick",function(e,t){return jp(e,t,!1).innerJoin()}),Pp=Rt("pickmod",function(e,t){return jp(e,t,!0).innerJoin()}),Np=Rt("pickF",function(e,t,s){return s.apply(Jp(e,t))}),Rp=Rt("pickmodF",function(e,t,s){return s.apply(Pp(e,t))}),Lp=Rt("pickOut",function(e,t){return jp(e,t,!1).outerJoin()}),Ip=Rt("pickmodOut",function(e,t){return jp(e,t,!0).outerJoin()}),Wp=Rt("pickRestart",function(e,t){return jp(e,t,!1).restartJoin()}),Hp=Rt("pickmodRestart",function(e,t){return jp(e,t,!0).restartJoin()}),Dp=Rt("pickReset",function(e,t){return jp(e,t,!1).resetJoin()}),Vp=Rt("pickmodReset",function(e,t){return jp(e,t,!0).resetJoin()}),{inhabit:Fp,pickSqueeze:Gp}=Rt(["inhabit","pickSqueeze"],function(e,t){return jp(e,t,!1).squeezeJoin()}),{inhabitmod:Up,pickmodSqueeze:Qp}=Rt(["inhabitmod","pickmodSqueeze"],function(e,t){return jp(e,t,!0).squeezeJoin()}),Kp=(e,t)=>0==(t=t.map(Ie)).length?Pe:e.fmap(e=>{const s=k(Math.round(e),t.length);return t[s]}).squeezeJoin();let $p;try{var Zp;$p=null===(Zp=window)||void 0===Zp?void 0:Zp.speechSynthesis}catch(dh){console.warn("cannot use window: not in browser?")}let Xp=null===(s=$p)||void 0===s?void 0:s.getVoices();const Yp=Rt("speak",function(e,t,s){return s.onTrigger(s=>{!function(e,t,s){$p.cancel();const n=new SpeechSynthesisUtterance(e);n.lang=t,Xp=$p.getVoices();const r=Xp.filter(e=>e.lang.includes(t));"number"==typeof s?n.voice=r[s%r.length]:"string"==typeof s&&(n.voice=r.find(e=>e.name===e)),speechSynthesis.speak(n)}(s.value,e,t)})}),eh={},th=async function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const n=await Promise.allSettled(t),r=n.filter(e=>"fulfilled"===e.status).map(e=>e.value);return n.forEach((e,t)=>{"rejected"===e.status&&console.warn("evalScope: module with index ".concat(t," could not be loaded:"),e.reason)}),r.forEach(e=>{Object.entries(e).forEach(e=>{let[t,s]=e;globalThis[t]=s,eh[t]=s})}),r};function sh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{wrapExpression:s=!0,wrapAsync:n=!0}=t;s&&(e="{".concat(e,"}")),n&&(e="(async ()=>".concat(e,")()"));const r='"use strict";return ('.concat(e,")");return Function(r)()}const nh=async(e,t,s)=>{let n={};if(t){const r=t(e,s);e=r.output,n=r}return{mode:"javascript",pattern:await sh(e,{wrapExpression:!!t}),meta:n}};class rh{constructor(e){let{onTrigger:t,onToggle:s,getTime:n}=e;this.started=!1,this.cps=.5,this.getTime=n,this.time_at_last_tick_message=0,this.collator=new ce({getTargetClockTime:n}),this.onToggle=s,this.latency=.1,this.cycle=0,this.id=Math.round(Date.now()*Math.random()),this.worker=new SharedWorker(new URL(""+new URL("assets/clockworker-ZDiUtESR.js",import.meta.url).href,import.meta.url)),this.worker.port.start(),this.channel=new BroadcastChannel("strudeltick");const r=e=>{const{cps:t,begin:s,end:n,cycle:r,time:o}=e;this.cps=t,this.cycle=r;const i=this.collator.calculateOffset(o)+o;a(s,n,i),this.time_at_last_tick_message=i},a=(e,s,n)=>{!1!==this.started&&this.pattern.queryArc(e,s,{_cps:this.cps}).forEach(e=>{if(e.hasOnset()){const s=ie(e.whole.begin-this.cycle,this.cps)+n+this.latency,r=ie(e.duration,this.cps);null===t||void 0===t||t(e,0,r,this.cps,s)}})};this.channel.onmessage=e=>{if(!this.started)return;const{payload:t,type:s}=e.data;if("tick"===s)r(t)}}sendMessage(e,t){this.worker.port.postMessage({type:e,payload:t,id:this.id})}now(){const e=(this.getTime()-this.time_at_last_tick_message)*this.cps;return this.cycle+e}setCps(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.sendMessage("cpschange",{cps:e})}setCycle(e){this.sendMessage("setcycle",{cycle:e})}setStarted(e){var t;this.sendMessage("toggle",{started:e}),this.started=e,null===(t=this.onToggle)||void 0===t||t.call(this,e)}start(){c("[cyclist] start"),this.setStarted(!0)}stop(){c("[cyclist] stop"),this.collator.reset(),this.setStarted(!1)}setPattern(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.pattern=e,t&&!this.started&&this.start()}log(e,t,s){const n=s.filter(e=>e.hasOnset());console.log("".concat(e.toFixed(4)," - ").concat(t.toFixed(4)," ").concat(Array(n.length).fill("I").join("")))}}class ah{constructor(e){let{interval:t,onTrigger:s,onToggle:n,onError:r,getTime:a,latency:o=.1,setInterval:c,clearInterval:u,beforeStart:l}=e;this.started=!1,this.beforeStart=l,this.cps=.5,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=a,this.num_cycles_at_cps_change=0,this.seconds_at_cps_change,this.onToggle=n,this.latency=o,this.clock=cl(a,(e,t,n,a)=>{0===this.num_ticks_since_cps_change&&(this.num_cycles_at_cps_change=this.lastEnd,this.seconds_at_cps_change=e),this.num_ticks_since_cps_change++;const c=this.num_ticks_since_cps_change*t*this.cps;try{const t=this.lastEnd;this.lastBegin=t;const n=this.num_cycles_at_cps_change+c;if(this.lastEnd=n,this.lastTick=e,e<a)return void console.log("skip query: too late");this.pattern.queryArc(t,n,{_cps:this.cps}).forEach(t=>{if(t.hasOnset()){const n=(t.whole.begin-this.num_cycles_at_cps_change)/this.cps+this.seconds_at_cps_change+o,r=t.duration/this.cps;null!==s&&void 0!==s&&s(t,n-e,r,this.cps,n),void 0!==t.value.cps&&this.cps!=t.value.cps&&(this.cps=t.value.cps,this.num_ticks_since_cps_change=0)}})}catch(u){i(u),null===r||void 0===r||r(u)}},t,.1,.1,c,u)}now(){if(!this.started)return 0;const e=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+e*this.cps}setStarted(e){var t;this.started=e,null===(t=this.onToggle)||void 0===t||t.call(this,e)}async start(){var e;if(await(null===(e=this.beforeStart)||void 0===e?void 0:e.call(this)),this.num_ticks_since_cps_change=0,this.num_cycles_at_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");c("[cyclist] start"),this.clock.start(),this.setStarted(!0)}pause(){c("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){c("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}async setPattern(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.pattern=e,t&&!this.started&&await this.start()}setCps(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;this.cps!==e&&(this.cps=e,this.num_ticks_since_cps_change=0)}log(e,t,s){const n=s.filter(e=>e.hasOnset());console.log("".concat(e.toFixed(4)," - ").concat(t.toFixed(4)," ").concat(Array(n.length).fill("I").join("")))}}let oh;function ih(){if(!oh)throw new Error("no time set! use setTime to define a time source");return oh()}function ch(e){oh=e}function uh(e){let{defaultOutput:t,onEvalError:s,beforeEval:n,beforeStart:r,afterEval:a,getTime:o,transpiler:i,onToggle:u,editPattern:l,onUpdateState:p,sync:h=!1,setInterval:d,clearInterval:f,id:m,mondo:y=!1}=e;const g={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},v={id:m},b=e=>{Object.assign(g,e),g.isDirty=g.code!==g.activeCode,g.error=g.evalError||g.schedulerError,null===p||void 0===p||p(g)},w={onTrigger:lh({defaultOutput:t,getTime:o}),getTime:o,onToggle:e=>{b({started:e}),null===u||void 0===u||u(e)},setInterval:d,clearInterval:f,beforeStart:r},_=h&&typeof SharedWorker<"u"?new rh(w):new ah(w);let k,A={},q=0;const S=function(){return A={},q=0,k=void 0,Pe},x=async function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e=(null===l||void 0===l?void 0:l(e))||e,await _.setPattern(e,t),e};ch(()=>_.now());const T=e=>_.setCps(e),z=e=>_.setCps(e/60);let C=[];const B=function(e){return C.push(e),Pe},O=function(e){return k=e,Pe},E=()=>{xe.prototype.p=function(e){return"string"==typeof e&&(e.startsWith("_")||e.endsWith("_"))?Pe:("$"===e&&(e="$".concat(q),q++),A[e]=this,this)},xe.prototype.q=function(e){return Pe};try{for(let e=1;e<10;++e)Object.defineProperty(xe.prototype,"d".concat(e),{get(){return this.p(e)},configurable:!0}),Object.defineProperty(xe.prototype,"p".concat(e),{get(){return this.p(e)},configurable:!0}),xe.prototype["q".concat(e)]=Pe}catch(t){console.warn("injectPatternMethods: error:",t)}const e=Rt("cpm",function(e,t){return t._fast(e/60/_.cps)});return th({all:B,each:O,hush:S,cpm:e,setCps:T,setcps:T,setCpm:z,setcpm:z})};return{scheduler:_,evaluate:async function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)throw new Error("no code to evaluate");try{b({code:e,pending:!0}),await E(),ch(()=>_.now()),await(null===n||void 0===n?void 0:n({code:e})),C=[],r&&S(),y&&(e="mondolang`".concat(e,"`"));let{pattern:s,meta:o}=await nh(e,i,v);if(Object.keys(A).length){let e=Object.values(A);k&&(e=e.map(e=>k(e))),s=He(...e)}else k&&(s=k(s));if(C.length)for(let e in C)s=C[e](s);if(!Le(s)){const e='got "'.concat(typeof evaluated,'" instead of pattern');throw new Error(e+("function"==typeof evaluated?", did you forget to call a function?":"."))}return c("[eval] code updated"),s=await x(s,t),b({miniLocations:(null===o||void 0===o?void 0:o.miniLocations)||[],widgets:(null===o||void 0===o?void 0:o.widgets)||[],activeCode:e,pattern:s,evalError:void 0,schedulerError:void 0,pending:!1}),null!==a&&void 0!==a&&a({code:e,pattern:s,meta:o}),s}catch(o){c("[eval] error: ".concat(o.message),"error"),console.error(o),b({evalError:o,pending:!1}),null===s||void 0===s||s(o)}},start:()=>_.start(),stop:()=>_.stop(),pause:()=>_.pause(),setCps:T,setPattern:x,setCode:e=>b({code:e}),toggle:()=>_.toggle(),state:g}}const lh=e=>{let{getTime:t,defaultOutput:s}=e;return async(e,n,r,a,o)=>{try{(!e.context.onTrigger||!e.context.dominantTrigger)&&await s(e,n,r,a,o),e.context.onTrigger&&await e.context.onTrigger(e,t(),a,o)}catch(c){i(c,"getTrigger")}}},ph=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=document.getElementById("code"),n="background-image:url("+e+");background-size:contain;";s.style=n;const{className:r}=s,a=Object.entries(t).filter(e=>{let[t,s]=e;return"function"==typeof s});Object.entries(t).filter(e=>{let[t,s]=e;return"string"==typeof s}).forEach(e=>{let[t,a]=e;return((e,t)=>{({style:()=>s.style=n+";"+t,className:()=>s.className=t+" "+r})[e]()})(t,a)}),a.length},hh=()=>{const e=document.getElementById("code");e&&(e.style="")};c("\ud83c\udf00 @strudel/core loaded \ud83c\udf00"),globalThis._strudelLoaded&&console.warn('@strudel/core was loaded more than once...\nThis might happen when you have multiple versions of strudel installed. \nPlease check with "npm ls @strudel/core".'),globalThis._strudelLoaded=!0;export{ce as ClockCollator,ah as Cyclist,me as Fraction,be as Hap,xe as Pattern,we as State,ve as TimeSpan,Zl as __chooseWith,Gl as _brandBy,bn as _fitslice,Kl as _irand,Bp as _keyDown,wn as _match,k as _mod,pr as _morph,kn as _polymeterListSteps,gn as _retime,vn as _slices,qr as accelerate,bi as activeLabel,xu as ad,yt as add,Su as adsr,Tp as almostAlways,xp as almostNever,Cp as always,zr as amp,Hr as analyze,Vi as anchor,Mt as and,fs as apply,zu as ar,Ce as arp,ze as arpWith,Ze as arrange,Uu as as,Br as att,Cr as attack,A as averageArray,ph as backgroundImage,kt as band,Zr as bandf,ea as bandq,Wr as bank,ne as base64ToUnicode,ka as bbexpr,qa as bbst,lr as beat,sa as begin,fp as berlin,hp as berlinWith,Rl as binary,Ll as binaryN,it as bind,Qc as binshift,_s as bite,Zu as bjork,St as blshift,At as bor,Yr as bp,no as bpa,so as bpattack,uo as bpd,co as bpdecay,Za as bpe,$a as bpenv,Xr as bpf,ta as bpq,ko as bpr,_o as bprelease,yo as bps,mo as bpsustain,Os as brak,Ql as brand,Ul as brandBy,xt as brshift,qt as bxor,un as bypass,_a as byteBeatExpression,Aa as byteBeatStartTime,qe as calculateSteps,$e as cat,Ju as ccn,Mu as ccv,Ht as ceil,xa as ch,Ia as channel,Sa as channels,ep as choose,np as chooseCycles,tp as chooseIn,Yl as chooseInWith,sp as chooseOut,Xl as chooseWith,Zn as chop,Wi as chord,Zs as chunk,en as chunkBack,cn as chunkBackInto,an as chunkInto,tn as chunkback,on as chunkbackinto,rn as chunkinto,F as clamp,hh as cleanupUi,ou as clip,la as coarse,re as code2hash,ku as color,Au as colour,Fc as comb,B as compose,Kt as compress,$t as compressSpan,hc as compressor,mc as compressorAttack,dc as compressorKnee,fc as compressorRatio,yc as compressorRelease,Zt as compressspan,J as constant,Bn as contract,ju as control,Ku as controls,gl as cosine,vl as cosine2,ms as cpm,au as cps,cl as createClock,fr as createParam,qu as createParams,ua as crush,Da as ctf,Pu as ctlNum,Ai as ctranspose,P as curry,pu as curve,Wa as cut,Ha as cutoff,ie as cycleToSeconds,Fr as dec,Vr as decay,gp as degrade,yp as degradeBy,mp as degradeByWith,_i as degree,Lo as delay,Wo as delayfb,Io as delayfeedback,Go as delaysync,Vo as delayt,Do as delaytime,hu as deltaSlide,Ko as det,Qo as detune,Ho as dfb,Di as dict,Hi as dictionary,pc as dist,lc as distort,bt as div,Ro as djf,_e as drawLine,wa as drive,Tn as drop,Xo as dry,Tu as ds,Fo as dt,ga as duck,ba as duckattack,va as duckdepth,uu as dur,cu as duration,el as e,ys as early,Ds as echo,Ls as echoWith,Is as echowith,il as eish,na as end,Dc as enhance,Ot as eq,Et as eqt,i as errorLogger,Yu as euclid,rl as euclidLegato,al as euclidLegatoRot,sl as euclidRot,ol as euclidish,tl as euclidrot,th as evalScope,nh as evaluate,ds as every,Cn as expand,qc as expression,zn as extend,ti as fadeInTime,ei as fadeOutTime,Yo as fadeTime,qo as fanchor,rs as fast,nn as fastChunk,Xt as fastGap,Ye as fastcat,sn as fastchunk,Yt as fastgap,Dr as fft,fn as filter,mn as filterWhen,hs as firstOf,rr as fit,E as flatten,Wt as floor,jr as fm,Mr as fmattack,Nr as fmdecay,Jr as fmenv,Or as fmh,Er as fmi,Lr as fmrelease,Rr as fmsustain,Ir as fmvelocity,Pr as fmwave,es as focus,ts as focusSpan,ss as focusspan,W as fractionalArgs,Zc as frameRate,Xc as frames,Rc as freeze,si as freq,y as freqToMidi,Vt as fromBipolar,xc as fshift,Tc as fshiftnote,zc as fshiftphase,Ao as ftype,Nt as func,xr as gain,Me as gap,mi as gat,fi as gate,Gu as getControlName,de as getCurrentKeyboardState,v as getEventOffsetMs,b as getFreq,T as getFrequency,ue as getPerformanceTimeSeconds,x as getPlayableNoteValue,S as getSoundIndex,ih as getTime,lh as getTrigger,jn as grow,zt as gt,Bt as gte,qi as harmonic,ae as hash2code,Kc as hbrick,Oo as hcutoff,$r as hold,Yc as hours,jo as hp,to as hpa,eo as hpattack,io as hpd,oo as hpdecay,Ka as hpe,Qa as hpenv,Eo as hpf,Mo as hpq,wo as hpr,bo as hprelease,fo as hps,ho as hpsustain,Jo as hresonance,dn as hsl,hn as hsla,os as hurry,j as id,Hc as imag,Fp as inhabit,Up as inhabitmod,ct as innerBind,us as inside,zs as inv,Ts as invert,tc as ir,$l as irand,rc as irbegin,sc as iresponse,nc as irspeed,yr as isControlName,l as isNote,u as isNoteWithOctave,Le as isPattern,dl as isaw,fl as isaw2,Gs as iter,Us as iterBack,Qs as iterback,Al as itri,ql as itri2,Rs as jux,Ps as juxBy,Ns as juxby,Oc as kcutoff,ft as keep,mt as keepif,pe as keyAlias,Ep as keyDown,Bc as krush,wi as label,ps as lastOf,gs as late,$c as lbrick,iu as legato,yi as leslie,mu as lfo,ks as linger,M as listRange,Uo as lock,r as logKey,c as logger,ra as loop,sr as loopAt,ar as loopAtCps,aa as loopBegin,ia as loopEnd,nr as loopat,or as loopatcps,oa as loopb,ca as loope,Fa as lp,Ya as lpa,Xa as lpattack,ao as lpd,ro as lpdecay,Ua as lpe,Ga as lpenv,Va as lpf,No as lpq,vo as lpr,go as lprelease,po as lps,lo as lpsustain,gi as lrate,vi as lsize,Tt as lt,Ct as lte,R as mapArgs,nt as mask,_ as midi2note,m as midiToFreq,Du as midibend,Cu as midichan,Eu as midicmd,Bu as midimap,Ou as midiport,Vu as miditouch,eu as minutes,wt as mod,Ui as mode,hr as morph,Ol as mouseX,Cl as mouseY,Bl as mousex,zl as mousey,ki as mtranspose,vt as mul,kr as n,q as nanFallback,jt as ne,Jt as net,zp as never,zo as noise,Ar as note,f as noteToMidi,Ne as nothing,Nu as nrpnn,Ru as nrpv,Ti as nudge,L as numeralArgs,oe as objectMap,zi as octave,xi as octaveR,Gi as octaves,Ec as octer,jc as octersub,Jc as octersubsub,Bs as off,Fi as offset,qp as often,Pt as or,Ci as orbit,ut as outerBind,ls as outside,Bi as overgain,Oi as overshape,_n as pace,V as pairs,Ms as palindrome,Ei as pan,di as panchor,Pi as panorient,ji as panspan,Ji as pansplay,Mi as panwidth,I as parseFractional,N as parseNumeral,Vc as partials,ri as patt,ni as pattack,hi as pcurve,oi as pdec,ai as pdecay,pi as penv,dp as perlin,lp as perlinWith,Oa as ph,La as phasdp,Ea as phaser,Ma as phasercenter,Na as phaserdepth,Ba as phaserrate,ja as phasersweep,Pa as phc,Ra as phd,Ja as phs,Jp as pick,Np as pickF,Lp as pickOut,Dp as pickReset,Wp as pickRestart,Gp as pickSqueeze,Pp as pickmod,Rp as pickmodF,Ip as pickmodOut,Vp as pickmodReset,Hp as pickmodRestart,Qp as pickmodSqueeze,C as pipe,du as pitchJump,fu as pitchJumpTime,ns as ply,Je as pm,ht as polyBind,Fu as polyTouch,An as polymeter,Ee as polyrhythm,Tr as postgain,_t as pow,je as pr,li as prel,ui as prelease,Js as press,js as pressBy,Lu as progNum,ci as psus,ii as psustain,Re as pure,Ta as pw,za as pwrate,Ca as pwsweep,Vl as rand,Fl as rand2,rp as randcat,Il as randrun,Ft as range,Ut as range2,Gt as rangex,Sp as rarely,Ni as rate,Qt as ratio,Xi as rdim,Wc as real,ir as ref,Rt as register,gr as registerControl,Ie as reify,Kr as rel,Qr as release,O as removeUndefineds,Ks as repeatCycles,yu as repeatTime,uh as repl,Po as resonance,Es as rev,ec as rfade,pn as rib,ln as ribbon,Mc as ring,Nc as ringdf,Pc as ringf,$i as rlp,Qi as room,Zi as roomdim,Yi as roomfade,Ki as roomlp,ac as roomsize,z as rotate,It as round,cc as rsize,Nl as run,vr as s,Dn as s_add,Ln as s_alt,Rn as s_cat,Un as s_contract,Fn as s_expand,Gn as s_extend,In as s_polymeter,Vn as s_sub,Wn as s_taper,Hn as s_taperlist,Qn as s_tour,Kn as s_zip,pl as saw,hl as saw2,Uc as scram,Dl as scramble,Qu as scrub,tu as seconds,qs as seg,As as segment,Li as semitone,tt as seq,Xe as seqPLoop,et as sequence,We as sequenceP,dt as set,Se as setStringParser,ch as setTime,uc as shape,En as shrink,On as shrinklist,Hl as shuffle,ll as signal,Pe as silence,yl as sine,ml as sine2,oc as size,er as slice,Ri as slide,is as slow,Ys as slowChunk,Qe as slowcat,Ke as slowcatPrime,Xs as slowchunk,Gc as smear,X as sol2note,Ap as someCycles,kp as someCyclesBy,_p as sometimes,wp as sometimesBy,su as songPtr,br as sound,wr as source,cs as sparsity,Yp as speak,gc as speed,tr as splice,H as splitAt,Zo as spread,bl as square,wl as square2,Kp as squeeze,lt as squeezeBind,wc as squiz,_r as src,He as stack,Ue as stackBy,Ge as stackCentre,Ve as stackLeft,Fe as stackRight,ul as steady,pt as stepBind,Sn as stepalt,qn as stepcat,$n as steps,Si as stepsPerOctave,vc as stretch,Xn as striate,fe as stringifyValues,rt as struct,eh as strudelScope,Vs as stut,Ws as stutWith,Hs as stutwith,gt as sub,at as superimpose,Ur as sus,Gr as sustain,Sc as sustainpedal,xs as swing,Ss as swingBy,Iu as sysex,Hu as sysexdata,Wu as sysexid,ic as sz,xn as take,Sl as time,Nn as timeCat,Pn as timecat,Dt as toBipolar,p as tokenizeNote,Jn as tour,pa as tremolo,da as tremolodepth,ma as tremolophase,ya as tremoloshape,fa as tremoloskew,ha as tremolosync,_l as tri,kl as tri2,Cc as triode,Ic as tsdelay,nu as uid,bp as undegrade,vp as undegradeBy,se as unicodeToBase64,Y as uniq,ee as uniqsort,te as uniqsortr,$o as unison,bc as unit,To as v,ru as val,g as valueToMidi,Sr as velocity,So as vib,Co as vibmod,xo as vibrato,Bo as vmod,Ii as voice,_c as vowel,kc as waveloss,op as wchoose,ip as wchooseCycles,Cs as when,Op as whenKey,ot as withValue,yn as within,cp as wrandcat,ur as xfade,Lc as xsdelay,bu as zcrush,wu as zdelay,Mn as zip,D as zipWith,vu as zmod,gu as znoise,vs as zoom,bs as zoomArc,ws as zoomarc,lu as zrand,_u as zzfx};